# ğŸš€ Microsoft 365 åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ æ¦‚è¦

Microsoft 365ã‚’æ•™è‚²æ©Ÿé–¢ã«å°å…¥ã™ã‚‹éš›ã®åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã‚’è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ãƒ†ãƒŠãƒ³ãƒˆä½œæˆã‹ã‚‰åŸºæœ¬çš„ãªç®¡ç†è¨­å®šã¾ã§ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè¡Œã§ãã‚‹åŒ…æ‹¬çš„ãªæ‰‹é †ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ¯ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®å…¨ä½“åƒ

```
Phase 1: æº–å‚™æ®µéšï¼ˆ1-2é€±é–“ï¼‰
â”œâ”€â”€ è¦ä»¶å®šç¾©ãƒ»è¨ˆç”»ç­–å®š
â”œâ”€â”€ æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®èª¿æŸ»
â”œâ”€â”€ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»DNSæº–å‚™
â””â”€â”€ å°å…¥ãƒãƒ¼ãƒ ç·¨æˆ

Phase 2: ãƒ†ãƒŠãƒ³ãƒˆä½œæˆï¼ˆ1-3æ—¥ï¼‰
â”œâ”€â”€ Microsoft 365ãƒ†ãƒŠãƒ³ãƒˆä½œæˆ
â”œâ”€â”€ åˆæœŸç®¡ç†è€…è¨­å®š
â”œâ”€â”€ åŸºæœ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
â””â”€â”€ ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ ãƒ»æ¤œè¨¼

Phase 3: åŸºç›¤è¨­å®šï¼ˆ1-2é€±é–“ï¼‰
â”œâ”€â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†åŸºç›¤
â”œâ”€â”€ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼è¨­å®š
â”œâ”€â”€ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†è¨­å®š
â””â”€â”€ åŸºæœ¬ã‚µãƒ¼ãƒ“ã‚¹æœ‰åŠ¹åŒ–
```

---

## ğŸ› ï¸ Phase 1: å°å…¥ã«å¿…è¦ãªæº–å‚™

### ğŸ“ è¦ä»¶å®šç¾©ã¨äº‹å‰èª¿æŸ»

#### 1. çµ„ç¹”æƒ…å ±ã®æ•´ç†

**å¿…è¦ãªçµ„ç¹”æƒ…å ±**
```
åŸºæœ¬æƒ…å ±ï¼š
â”œâ”€â”€ çµ„ç¹”åï¼ˆæ­£å¼åç§°ãƒ»è‹±èªè¡¨è¨˜ï¼‰
â”œâ”€â”€ æ‰€åœ¨åœ°ãƒ»é€£çµ¡å…ˆæƒ…å ±
â”œâ”€â”€ æ•™è‚²æ©Ÿé–¢ç¨®åˆ¥ï¼ˆå°å­¦æ ¡/ä¸­å­¦æ ¡/é«˜ç­‰å­¦æ ¡/å¤§å­¦ç­‰ï¼‰
â”œâ”€â”€ å­¦ç”Ÿæ•°ãƒ»æ•™è·å“¡æ•°
â””â”€â”€ æ—¢å­˜ITã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

æŠ€è¡“è¦ä»¶ï¼š
â”œâ”€â”€ æ—¢å­˜ãƒ‰ãƒ¡ã‚¤ãƒ³å
â”œâ”€â”€ DNSç®¡ç†çŠ¶æ³
â”œâ”€â”€ æ—¢å­˜ãƒ¡ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
â”œâ”€â”€ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ
â””â”€â”€ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
```

#### 2. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è¨ˆç”»ã®ç­–å®š

**ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†é¡ã¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è¨ˆç”»**

| ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¨®åˆ¥ | æƒ³å®šäººæ•° | æ¨å¥¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | ç†ç”± |
|---|---|---|---|
| **ç®¡ç†è€…** | 2-5å | A5 | é«˜åº¦ãªç®¡ç†æ©Ÿèƒ½ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ |
| **æ•™è·å“¡** | â—‹â—‹å | A3 | ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªãƒ»ãƒ‡ãƒã‚¤ã‚¹ç®¡ç† |
| **å­¦ç”Ÿï¼ˆé«˜å­¦å¹´ï¼‰** | â—‹â—‹å | A3 | æœ¬æ ¼çš„ãªICTæ´»ç”¨ |
| **å­¦ç”Ÿï¼ˆä½å­¦å¹´ï¼‰** | â—‹â—‹å | A1 | åŸºæœ¬æ©Ÿèƒ½ã§ã®å°å…¥ |

**ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ•°è¨ˆç®—ä¾‹**
```powershell
# ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¿…è¦æ•°ã®è¨ˆç®—ãƒ†ãƒ³ãƒ—ãƒ¼ãƒˆ

$organizationData = @{
    Administrators = 3
    Faculty = 50
    SeniorStudents = 200
    JuniorStudents = 300
    GuestUsers = 10
}

$licenseRequirement = @{
    A5_Licenses = $organizationData.Administrators
    A3_Licenses = $organizationData.Faculty + $organizationData.SeniorStudents
    A1_Licenses = $organizationData.JuniorStudents + $organizationData.GuestUsers
}

Write-Host "=== ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¿…è¦æ•° ==="
Write-Host "A5 ãƒ©ã‚¤ã‚»ãƒ³ã‚¹: $($licenseRequirement.A5_Licenses) å€‹"
Write-Host "A3 ãƒ©ã‚¤ã‚»ãƒ³ã‚¹: $($licenseRequirement.A3_Licenses) å€‹"
Write-Host "A1 ãƒ©ã‚¤ã‚»ãƒ³ã‚¹: $($licenseRequirement.A1_Licenses) å€‹"
```

#### 3. ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨DNSã®æº–å‚™

**ãƒ‰ãƒ¡ã‚¤ãƒ³è¦ä»¶ã®ç¢ºèª**
```
å¿…è¦ãªãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ï¼š
â”œâ”€â”€ çµ„ç¹”ã®å…¬å¼ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆä¾‹ï¼šschool.edu.jpï¼‰
â”œâ”€â”€ DNSç®¡ç†æ¨©é™ã®ç¢ºèª
â”œâ”€â”€ æ—¢å­˜ãƒ¡ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºè¦ä»¶
â””â”€â”€ ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ©ç”¨ã®æ¤œè¨

DNSè¨­å®šæº–å‚™ï¼š
â”œâ”€â”€ MXãƒ¬ã‚³ãƒ¼ãƒ‰è¨­å®šæ¨©é™
â”œâ”€â”€ TXTãƒ¬ã‚³ãƒ¼ãƒ‰è¨­å®šæ¨©é™
â”œâ”€â”€ CNAMEãƒ¬ã‚³ãƒ¼ãƒ‰è¨­å®šæ¨©é™
â””â”€â”€ å¤‰æ›´åæ˜ æ™‚é–“ã®ç¢ºèª
```

**DNSç®¡ç†è€…ã¸ã®äº‹å‰é€£çµ¡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**
```
ä»¶å: Microsoft 365å°å…¥ã«ä¼´ã†DNSè¨­å®šå¤‰æ›´ã®ãŠé¡˜ã„

Microsoft 365ã®å°å…¥ã«ä¼´ã„ã€ä»¥ä¸‹ã®DNSè¨­å®šå¤‰æ›´ãŒå¿…è¦ã«ãªã‚Šã¾ã™ï¼š

1. ãƒ‰ãƒ¡ã‚¤ãƒ³æ‰€æœ‰æ¨©æ¤œè¨¼ç”¨TXTãƒ¬ã‚³ãƒ¼ãƒ‰
   - ãƒ¬ã‚³ãƒ¼ãƒ‰å: [è¨­å®šæ™‚ã«æŒ‡å®š]
   - å€¤: [è¨­å®šæ™‚ã«æŒ‡å®š]

2. ãƒ¡ãƒ¼ãƒ«é…ä¿¡ç”¨MXãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆæ®µéšçš„ç§»è¡Œæ™‚ï¼‰
   - å„ªå…ˆåº¦: [è¨­å®šæ™‚ã«æŒ‡å®š]
   - å€¤: [ãƒ†ãƒŠãƒ³ãƒˆå].mail.protection.outlook.com

3. ãã®ä»–èªè¨¼ç”¨ãƒ¬ã‚³ãƒ¼ãƒ‰
   - SPFã€DKIMã€DMARCè¨­å®š

è¨­å®šæ—¥ç¨‹ã«ã¤ã„ã¦ç›¸è«‡ã•ã›ã¦ãã ã•ã„ã€‚
```

#### 4. æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆè¨ˆç”»

**æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ èª¿æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**
```
ãƒ¡ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼š
â–¡ ç¾åœ¨ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ï¼ˆExchange Serverç­‰ï¼‰
â–¡ ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹æ•°ãƒ»ã‚µã‚¤ã‚º
â–¡ æ—¢å­˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
â–¡ ã‚«ã‚¹ã‚¿ãƒ è¨­å®šãƒ»ãƒ«ãƒ¼ãƒ«

èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼š
â–¡ Active Directory Domain Services
â–¡ LDAP ã‚µãƒ¼ãƒãƒ¼
â–¡ ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³è¨­å®š
â–¡ å¤šè¦ç´ èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ï¼š
â–¡ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼æ§‹æˆ
â–¡ å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ 
â–¡ ã‚¢ã‚¯ã‚»ã‚¹æ¨©è¨­å®š
â–¡ ãƒ‡ãƒ¼ã‚¿å®¹é‡

å­¦ç¿’ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼š
â–¡ LMSï¼ˆLearning Management Systemï¼‰
â–¡ å­¦ç”Ÿæƒ…å ±ã‚·ã‚¹ãƒ†ãƒ 
â–¡ æˆç¸¾ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
â–¡ å›³æ›¸ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
```

### ğŸ‘¥ å°å…¥ãƒãƒ¼ãƒ ã®ç·¨æˆ

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ¼ãƒ æ§‹æˆ

**æ¨å¥¨ãƒãƒ¼ãƒ æ§‹æˆ**
```
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆ1åï¼‰
â”œâ”€â”€ å…¨ä½“é€²è¡Œç®¡ç†
â”œâ”€â”€ é–¢ä¿‚è€…èª¿æ•´
â””â”€â”€ æ„æ€æ±ºå®šæ”¯æ´

æŠ€è¡“è²¬ä»»è€…ï¼ˆ1-2åï¼‰
â”œâ”€â”€ ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆãƒ»æ§‹ç¯‰
â”œâ”€â”€ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
â””â”€â”€ æŠ€è¡“çš„èª²é¡Œè§£æ±º

é‹ç”¨è²¬ä»»è€…ï¼ˆ1-2åï¼‰
â”œâ”€â”€ æ—¥å¸¸é‹ç”¨è¨­è¨ˆ
â”œâ”€â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆä½“åˆ¶
â””â”€â”€ é‹ç”¨æ‰‹é †æ›¸ä½œæˆ

æ•™è‚²æ‹…å½“è€…ï¼ˆ2-3åï¼‰
â”œâ”€â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨ˆç”»
â”œâ”€â”€ åˆ©ç”¨ã‚¬ã‚¤ãƒ‰ä½œæˆ
â””â”€â”€ æ®µéšçš„å±•é–‹æ”¯æ´
```

**å„æ‹…å½“è€…ã®äº‹å‰æº–å‚™**

| å½¹å‰² | äº‹å‰æº–å‚™é …ç›® |
|---|---|
| **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼** | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”»æ›¸ã€äºˆç®—ç¢ºä¿ã€ä¸Šå±¤éƒ¨æ‰¿èª |
| **æŠ€è¡“è²¬ä»»è€…** | Microsoft 365æŠ€è¡“ç¿’å¾—ã€æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ èª¿æŸ» |
| **é‹ç”¨è²¬ä»»è€…** | é‹ç”¨ãƒãƒªã‚·ãƒ¼ç­–å®šã€ã‚µãƒãƒ¼ãƒˆä½“åˆ¶è¨­è¨ˆ |
| **æ•™è‚²æ‹…å½“è€…** | æ•™è‚²è¨ˆç”»ç­–å®šã€æ•™ææº–å‚™ |

---

## ğŸ—ï¸ Phase 2: Microsoft 365ãƒ†ãƒŠãƒ³ãƒˆã®ä½œæˆã¨åˆæœŸè¨­å®š

### ğŸ« ãƒ†ãƒŠãƒ³ãƒˆä½œæˆæ‰‹é †

#### 1. Microsoft 365 Education ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—

**ã‚¢ã‚¯ã‚»ã‚¹æ‰‹é †**
1. **æ•™è‚²æ©Ÿé–¢å‘ã‘ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹**
   ```
   URL: https://www.microsoft.com/ja-jp/education/products/office
   ```

2. **ã€Œç„¡æ–™ã§ä½¿ã£ã¦ã¿ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯**
   - A1ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‹ã‚‰é–‹å§‹å¯èƒ½
   - å¾Œã‹ã‚‰A3/A5ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¯èƒ½

3. **çµ„ç¹”æƒ…å ±ã®å…¥åŠ›**
   ```
   å¿…è¦æƒ…å ±ï¼š
   â”œâ”€â”€ çµ„ç¹”åï¼ˆæ­£å¼åç§°ï¼‰
   â”œâ”€â”€ å›½/åœ°åŸŸ
   â”œâ”€â”€ æ•™è‚²æ©Ÿé–¢ç¨®åˆ¥
   â”œâ”€â”€ å­¦ç”Ÿæ•°è¦æ¨¡
   â””â”€â”€ ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
   ```

#### 2. åˆæœŸãƒ†ãƒŠãƒ³ãƒˆè¨­å®š

**ãƒ†ãƒŠãƒ³ãƒˆä½œæˆæ™‚ã®é‡è¦ãªè¨­å®š**

```powershell
# ãƒ†ãƒŠãƒ³ãƒˆä½œæˆå¾Œã®åˆæœŸç¢ºèªã‚³ãƒãƒ³ãƒ‰

# Microsoft Graph PowerShell ã«æ¥ç¶š
Connect-MgGraph -Scopes "Organization.Read.All", "Directory.ReadWrite.All"

# ãƒ†ãƒŠãƒ³ãƒˆåŸºæœ¬æƒ…å ±ã®ç¢ºèª
Get-MgOrganization | Select-Object DisplayName, Id, CreatedDateTime, Country

# åˆæœŸãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã®ç¢ºèª
Get-MgDomain | Select-Object Id, IsDefault, IsInitial, IsVerified
```

**ãƒ†ãƒŠãƒ³ãƒˆåŸºæœ¬è¨­å®šã®ç¢ºèªé …ç›®**
```
ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ï¼š
â–¡ ãƒ†ãƒŠãƒ³ãƒˆåã®ç¢ºèª
â–¡ åˆæœŸãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ.onmicrosoft.comï¼‰ã®ç¢ºèª
â–¡ åœ°åŸŸè¨­å®šã®ç¢ºèª
â–¡ ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®š

ç®¡ç†è€…è¨­å®šï¼š
â–¡ å…¨ä½“ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ
â–¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®ç¢ºèª
â–¡ é€šçŸ¥è¨­å®šã®ç¢ºèª
```

#### 3. Microsoft 365ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

**ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ã®å ´æ‰€ã¨ã‚¢ã‚¯ã‚»ã‚¹**
```
ä¸»è¦ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ï¼š
â”œâ”€â”€ Microsoft 365ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼: https://admin.microsoft.com
â”œâ”€â”€ Microsoft Entraç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼: https://entra.microsoft.com
â”œâ”€â”€ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚»ãƒ³ã‚¿ãƒ¼: https://security.microsoft.com
â”œâ”€â”€ ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼: https://compliance.microsoft.com
â””â”€â”€ Exchangeã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼: https://admin.exchange.microsoft.com
```

### ğŸ” ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆã¨åˆæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

#### 1. ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

**ç·Šæ€¥æ™‚ã‚¢ã‚¯ã‚»ã‚¹ç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆBreak Glass Accountï¼‰ã®ä½œæˆ**

```powershell
# ç·Šæ€¥æ™‚ã‚¢ã‚¯ã‚»ã‚¹ç”¨ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

# ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã®å®šç¾©
$emergencyAdmin = @{
    DisplayName = "Emergency Administrator"
    UserPrincipalName = "emergency-admin@yourdomain.onmicrosoft.com"
    PasswordProfile = @{
        Password = "ComplexPassword123!"
        ForceChangePasswordNextSignIn = $false
    }
    AccountEnabled = $true
}

# ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
$newUser = New-MgUser @emergencyAdmin

# å…¨ä½“ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ã®å‰²ã‚Šå½“ã¦
$globalAdminRole = Get-MgDirectoryRole | Where-Object {$_.DisplayName -eq "Global Administrator"}
New-MgDirectoryRoleMember -DirectoryRoleId $globalAdminRole.Id -BodyParameter @{
    "@odata.id" = "https://graph.microsoft.com/v1.0/directoryObjects/$($newUser.Id)"
}

Write-Host "ç·Šæ€¥æ™‚ã‚¢ã‚¯ã‚»ã‚¹ç”¨ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ: $($emergencyAdmin.UserPrincipalName)"
```

**æ—¥å¸¸æ¥­å‹™ç”¨ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ**

```powershell
# å°‚é–€åˆ†é‡åˆ¥ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆä¾‹

$administrators = @(
    @{
        DisplayName = "IT Manager"
        UserPrincipalName = "it-manager@yourdomain.onmicrosoft.com"
        Department = "IT"
        Roles = @("Global Administrator", "Security Administrator")
    },
    @{
        DisplayName = "Security Manager"
        UserPrincipalName = "security-manager@yourdomain.onmicrosoft.com"
        Department = "IT"
        Roles = @("Security Administrator", "Compliance Administrator")
    },
    @{
        DisplayName = "User Manager"
        UserPrincipalName = "user-manager@yourdomain.onmicrosoft.com"
        Department = "HR"
        Roles = @("User Administrator", "License Administrator")
    }
)

foreach ($admin in $administrators) {
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
    $newAdmin = New-MgUser @{
        DisplayName = $admin.DisplayName
        UserPrincipalName = $admin.UserPrincipalName
        Department = $admin.Department
        PasswordProfile = @{
            Password = "TempPassword123!"
            ForceChangePasswordNextSignIn = $true
        }
        AccountEnabled = $true
    }
    
    # ãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦
    foreach ($roleName in $admin.Roles) {
        $role = Get-MgDirectoryRole | Where-Object {$_.DisplayName -eq $roleName}
        if ($role) {
            New-MgDirectoryRoleMember -DirectoryRoleId $role.Id -BodyParameter @{
                "@odata.id" = "https://graph.microsoft.com/v1.0/directoryObjects/$($newAdmin.Id)"
            }
        }
    }
    
    Write-Host "ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ: $($admin.DisplayName)"
}
```

#### 2. åˆæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

**å¤šè¦ç´ èªè¨¼ï¼ˆMFAï¼‰ã®è¨­å®š**

```powershell
# å…¨ç®¡ç†è€…ã«å¯¾ã™ã‚‹MFAè¦æ±‚ã®è¨­å®š

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æœ‰åŠ¹åŒ–ï¼ˆæ¨å¥¨ï¼‰
$securityDefaults = @{
    IsEnabled = $true
    Description = "Security defaults enabled for all users"
}

# æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã®ä½œæˆï¼ˆã‚ˆã‚Šè©³ç´°ãªåˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆï¼‰
$mfaPolicy = @{
    DisplayName = "Require MFA for Administrators"
    State = "enabled"
    Conditions = @{
        Users = @{
            IncludeRoles = @(
                "62e90394-69f5-4237-9190-012177145e10", # Global Administrator
                "194ae4cb-b126-40b2-bd5b-6091b380977d"  # Security Administrator
            )
        }
        Applications = @{
            IncludeApplications = @("All")
        }
    }
    GrantControls = @{
        Operator = "AND"
        BuiltInControls = @("mfa")
    }
}

# æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã®ä½œæˆ
New-MgIdentityConditionalAccessPolicy -BodyParameter $mfaPolicy
```

**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã®è¨­å®š**

```powershell
# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã®è¨­å®š

$passwordPolicy = @{
    DefaultPasswordRuleSet = @{
        BannedPasswordCheckOnPremisesMode = "Audit"
        EnableBannedPasswordCheck = $true
        BannedPasswordList = @(
            "password", "123456", "school", "student", "admin"
        )
    }
    PasswordComplexityRules = @{
        MinimumLength = 12
        RequireUppercase = $true
        RequireLowercase = $true
        RequireNumbers = $true
        RequireSymbols = $true
    }
}

Write-Host "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ"
```

**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒãƒªã‚·ãƒ¼ã®è¨­å®š**

```powershell
# ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒªã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªã‚·ãƒ¼è¨­å®š

$signInRiskPolicy = @{
    DisplayName = "Block high-risk sign-ins"
    State = "enabled"
    Conditions = @{
        Users = @{
            IncludeUsers = @("All")
        }
        SignInRiskLevels = @("high")
    }
    GrantControls = @{
        Operator = "OR"
        BuiltInControls = @("block")
    }
}

New-MgIdentityConditionalAccessPolicy -BodyParameter $signInRiskPolicy
```

#### 3. ç›£æŸ»ãƒ­ã‚°ã¨ã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š

**ç›£æŸ»ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–**

```powershell
# çµ±åˆç›£æŸ»ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–ã¨è¨­å®š

# Exchange Online PowerShell ã¸ã®æ¥ç¶šãŒå¿…è¦
# Connect-ExchangeOnline

# çµ±åˆç›£æŸ»ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–
Set-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $true

# ç›£æŸ»ãƒ­ã‚°ä¿æŒæœŸé–“ã®è¨­å®šï¼ˆ90æ—¥é–“ï¼‰
Set-AdminAuditLogConfig -AdminAuditLogAgeLimit 90.00:00:00

# é‡è¦ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®ç›£æŸ»è¨­å®š
$auditSettings = @{
    AuditEnabled = $true
    DefaultAuditSet = @(
        "UserLoggedIn",
        "UserLoginFailed", 
        "UserPasswordChanged",
        "UserAdded",
        "UserDeleted",
        "RoleAssignmentAdded",
        "AdminSubmittedQuarantineRelease"
    )
}

Write-Host "ç›£æŸ»ãƒ­ã‚°è¨­å®šã‚’å®Œäº†ã—ã¾ã—ãŸ"
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š**

```powershell
# Microsoft 365 Defender ã§ã®ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

$securityAlerts = @(
    @{
        Name = "High-risk sign-in detected"
        Description = "Alert when high-risk sign-in is detected"
        Severity = "High"
        Category = "Authentication"
    },
    @{
        Name = "Mass file download"
        Description = "Alert when unusual file download activity is detected"
        Severity = "Medium"
        Category = "Data Loss Prevention"
    },
    @{
        Name = "Admin role assignment"
        Description = "Alert when admin roles are assigned"
        Severity = "High"
        Category = "Identity and Access"
    }
)

foreach ($alert in $securityAlerts) {
    Write-Host "ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š: $($alert.Name)"
    # å®Ÿéš›ã®ã‚¢ãƒ©ãƒ¼ãƒˆä½œæˆã¯Microsoft 365 Defenderã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰å®Ÿè¡Œ
}
```

---

## ğŸŒ Phase 3: ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¿½åŠ ã¨æ¤œè¨¼æ‰‹ç¶šã

### ğŸ“ ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ ã®æº–å‚™

#### 1. ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ å‰ã®ç¢ºèªäº‹é …

**ãƒ‰ãƒ¡ã‚¤ãƒ³è¦ä»¶ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**
```
æŠ€è¡“è¦ä»¶ï¼š
â–¡ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ‰€æœ‰æ¨©ç¢ºèª
â–¡ DNSç®¡ç†æ¨©é™ã®ç¢ºä¿
â–¡ æ—¢å­˜ãƒ¡ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã®æ•´åˆæ€§
â–¡ ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ©ç”¨ã®æ¤œè¨

é‹ç”¨è¦ä»¶ï¼š
â–¡ ãƒ¡ãƒ¼ãƒ«ç§»è¡Œè¨ˆç”»ã®ç­–å®š
â–¡ ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥è¨ˆç”»
â–¡ ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ è¨±å®¹æ™‚é–“
â–¡ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»
```

#### 2. ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ æ‰‹é †

**Microsoft 365ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ã§ã®ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ **

1. **ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ã§ã®ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ é–‹å§‹**
   ```
   æ‰‹é †ï¼š
   1. Microsoft 365ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ (https://admin.microsoft.com) ã«ã‚¢ã‚¯ã‚»ã‚¹
   2. [è¨­å®š] > [ãƒ‰ãƒ¡ã‚¤ãƒ³] ã‚’é¸æŠ
   3. [ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¿½åŠ ] ã‚’ã‚¯ãƒªãƒƒã‚¯
   4. ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šschool.edu.jpï¼‰
   ```

2. **PowerShellã§ã®ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ **
   ```powershell
   # PowerShellã‚’ä½¿ç”¨ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ 

   # ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ 
   $domainName = "school.edu.jp"
   New-MgDomain -Id $domainName

   # ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã®ç¢ºèª
   Get-MgDomain -DomainId $domainName | Select-Object Id, IsVerified, SupportedServices
   ```

#### 3. ãƒ‰ãƒ¡ã‚¤ãƒ³æ‰€æœ‰æ¨©ã®æ¤œè¨¼

**TXTãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ¤œè¨¼**

```powershell
# ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼ç”¨TXTãƒ¬ã‚³ãƒ¼ãƒ‰ã®å–å¾—

$domain = Get-MgDomain -DomainId $domainName
$verificationRecord = Get-MgDomainVerificationDnsRecord -DomainId $domainName

Write-Host "=== ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼æƒ…å ± ==="
Write-Host "ãƒ‰ãƒ¡ã‚¤ãƒ³å: $($domain.Id)"
Write-Host "æ¤œè¨¼ãƒ¬ã‚³ãƒ¼ãƒ‰ç¨®åˆ¥: $($verificationRecord.RecordType)"
Write-Host "æ¤œè¨¼å€¤: $($verificationRecord.Text)"
Write-Host ""
Write-Host "DNSè¨­å®šä¾‹:"
Write-Host "ç¨®åˆ¥: TXT"
Write-Host "åå‰: @ ã¾ãŸã¯ $domainName"
Write-Host "å€¤: $($verificationRecord.Text)"
```

**DNSè¨­å®šã®å®Ÿè£…ä¾‹**

```bash
# DNSè¨­å®šä¾‹ï¼ˆBindå½¢å¼ï¼‰

# ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼ç”¨TXTãƒ¬ã‚³ãƒ¼ãƒ‰
school.edu.jp.    IN    TXT    "MS=ms12345678"

# ãƒ¡ãƒ¼ãƒ«é…ä¿¡ç”¨MXãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆæ¤œè¨¼å¾Œã«è¨­å®šï¼‰
school.edu.jp.    IN    MX    10    school-edu-jp.mail.protection.outlook.com.

# SPFãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ¡ãƒ¼ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰
school.edu.jp.    IN    TXT    "v=spf1 include:spf.protection.outlook.com -all"

# DKIMè¨­å®šç”¨CNAMEãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆMicrosoft 365ã§è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹å€¤ã‚’ä½¿ç”¨ï¼‰
selector1._domainkey.school.edu.jp.    IN    CNAME    selector1-school-edu-jp._domainkey.yourtenant.onmicrosoft.com.
selector2._domainkey.school.edu.jp.    IN    CNAME    selector2-school-edu-jp._domainkey.yourtenant.onmicrosoft.com.
```

#### 4. ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼ã®å®Ÿè¡Œã¨ç¢ºèª

**æ¤œè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã®è‡ªå‹•åŒ–**

```powershell
# ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼ã®è‡ªå‹•ç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆ

function Test-DomainVerification {
    param(
        [string]$DomainName,
        [int]$MaxRetries = 10,
        [int]$DelaySeconds = 30
    )
    
    $retryCount = 0
    
    while ($retryCount -lt $MaxRetries) {
        try {
            # ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼ã®å®Ÿè¡Œ
            Invoke-MgVerifyDomain -DomainId $DomainName
            
            # æ¤œè¨¼çŠ¶æ…‹ã®ç¢ºèª
            $domain = Get-MgDomain -DomainId $DomainName
            
            if ($domain.IsVerified) {
                Write-Host "âœ… ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼æˆåŠŸ: $DomainName" -ForegroundColor Green
                return $true
            }
            else {
                Write-Host "â³ æ¤œè¨¼å¾…æ©Ÿä¸­... ($($retryCount + 1)/$MaxRetries)" -ForegroundColor Yellow
                Start-Sleep -Seconds $DelaySeconds
                $retryCount++
            }
        }
        catch {
            Write-Host "âŒ æ¤œè¨¼ã‚¨ãƒ©ãƒ¼: $($_.Exception.Message)" -ForegroundColor Red
            Start-Sleep -Seconds $DelaySeconds
            $retryCount++
        }
    }
    
    Write-Host "âŒ ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼å¤±æ•—: $DomainName" -ForegroundColor Red
    return $false
}

# ä½¿ç”¨ä¾‹
$verificationResult = Test-DomainVerification -DomainName "school.edu.jp"
```

#### 5. ãƒ¡ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨­å®š

**æ®µéšçš„ãƒ¡ãƒ¼ãƒ«ç§»è¡Œã®è¨­å®š**

```powershell
# ãƒ¡ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šï¼ˆæ®µéšçš„ç§»è¡Œç”¨ï¼‰

# Exchange Online PowerShellæ¥ç¶š
# Connect-ExchangeOnline

# æ‰¿èªã•ã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨­å®š
New-AcceptedDomain -Name "school.edu.jp" -DomainName "school.edu.jp" -DomainType Authoritative

# ãƒ¡ãƒ¼ãƒ«é…ä¿¡ãƒãƒªã‚·ãƒ¼ã®è¨­å®š
$emailPolicy = @{
    Name = "School Email Policy"
    Domains = @("school.edu.jp")
    MatchedSenderAttributes = @("Department")
    RouteBasedOnDepartment = $true
}

# æ®µéšçš„ç§»è¡Œç”¨ã®ã‚³ãƒã‚¯ã‚¿è¨­å®šï¼ˆæ—¢å­˜ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€£æºï¼‰
$onPremConnector = @{
    Name = "OnPremises-Inbound"
    ConnectorType = "OnPremises"
    ConnectorSource = "Default"
    SmartHosts = @("mail.school.edu.jp")
    TlsSettings = @{
        RequireTls = $true
        CertificateValidation = "Enabled"
    }
}

Write-Host "ãƒ¡ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã‚’å®Œäº†ã—ã¾ã—ãŸ"
```

### ğŸ”§ ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šã®æœ€é©åŒ–

#### 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ã‚³ãƒ¼ãƒ‰ã®è¨­å®š

**å®Œå…¨ãªDNSã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š**

```powershell
# æ¨å¥¨DNSã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®ç”Ÿæˆ

function Generate-SecurityDNSRecords {
    param(
        [string]$DomainName,
        [string]$TenantName
    )
    
    $dnsRecords = @"
=== $DomainName ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£DNSè¨­å®š ===

# SPF ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡å…ƒèªè¨¼ï¼‰
$DomainName.    IN    TXT    "v=spf1 include:spf.protection.outlook.com -all"

# DMARC ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ¡ãƒ¼ãƒ«èªè¨¼ãƒãƒªã‚·ãƒ¼ï¼‰
_dmarc.$DomainName.    IN    TXT    "v=DMARC1; p=quarantine; rua=mailto:dmarc@$DomainName; ruf=mailto:dmarc@$DomainName"

# DKIM ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼1
selector1._domainkey.$DomainName.    IN    CNAME    selector1-$(($DomainName -replace '\.', '-'))._domainkey.$TenantName.onmicrosoft.com.

# DKIM ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼2  
selector2._domainkey.$DomainName.    IN    CNAME    selector2-$(($DomainName -replace '\.', '-'))._domainkey.$TenantName.onmicrosoft.com.

# Exchange Autodiscover
autodiscover.$DomainName.    IN    CNAME    autodiscover.outlook.com.

# SIPé€£æºï¼ˆTeamsï¼‰
sip.$DomainName.    IN    CNAME    sipdir.online.lync.com.
lyncdiscover.$DomainName.    IN    CNAME    webdir.online.lync.com.

# ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†
enterpriseregistration.$DomainName.    IN    CNAME    enterpriseregistration.windows.net.
enterpriseenrollment.$DomainName.    IN    CNAME    enterpriseenrollment.manage.microsoft.com.
"@
    
    return $dnsRecords
}

# ä½¿ç”¨ä¾‹
$dnsConfig = Generate-SecurityDNSRecords -DomainName "school.edu.jp" -TenantName "schooledu"
Write-Host $dnsConfig
```

#### 2. ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šã®æ¤œè¨¼

**åŒ…æ‹¬çš„ãªãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šãƒã‚§ãƒƒã‚¯**

```powershell
# ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šã®ç·åˆæ¤œè¨¼

function Test-DomainConfiguration {
    param([string]$DomainName)
    
    $results = @()
    
    # åŸºæœ¬ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±
    $domain = Get-MgDomain -DomainId $DomainName
    $results += [PSCustomObject]@{
        Check = "ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼"
        Status = if($domain.IsVerified) {"âœ… æˆåŠŸ"} else {"âŒ å¤±æ•—"}
        Details = "æ¤œè¨¼çŠ¶æ…‹: $($domain.IsVerified)"
    }
    
    # DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç¢ºèª
    try {
        $mxRecords = Resolve-DnsName -Name $DomainName -Type MX -ErrorAction Stop
        $results += [PSCustomObject]@{
            Check = "MXãƒ¬ã‚³ãƒ¼ãƒ‰"
            Status = "âœ… è¨­å®šæ¸ˆã¿"
            Details = "å„ªå…ˆåº¦: $($mxRecords[0].Preference), å€¤: $($mxRecords[0].NameExchange)"
        }
    }
    catch {
        $results += [PSCustomObject]@{
            Check = "MXãƒ¬ã‚³ãƒ¼ãƒ‰"
            Status = "âŒ æœªè¨­å®š"
            Details = "MXãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        }
    }
    
    # SPF ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç¢ºèª
    try {
        $spfRecords = Resolve-DnsName -Name $DomainName -Type TXT -ErrorAction Stop | 
                     Where-Object {$_.Strings -match "v=spf1"}
        if ($spfRecords) {
            $results += [PSCustomObject]@{
                Check = "SPFãƒ¬ã‚³ãƒ¼ãƒ‰"
                Status = "âœ… è¨­å®šæ¸ˆã¿"
                Details = $spfRecords.Strings[0]
            }
        }
        else {
            $results += [PSCustomObject]@{
                Check = "SPFãƒ¬ã‚³ãƒ¼ãƒ‰"
                Status = "âš ï¸ æœªè¨­å®š"
                Details = "SPFãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            }
        }
    }
    catch {
        $results += [PSCustomObject]@{
            Check = "SPFãƒ¬ã‚³ãƒ¼ãƒ‰"
            Status = "âŒ ã‚¨ãƒ©ãƒ¼"
            Details = "DNSè§£æ±ºã‚¨ãƒ©ãƒ¼"
        }
    }
    
    return $results
}

# ä½¿ç”¨ä¾‹ã¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
$domainCheck = Test-DomainConfiguration -DomainName "school.edu.jp"
$domainCheck | Format-Table -AutoSize

# çµæœã‚’CSVã«å‡ºåŠ›
$domainCheck | Export-Csv "domain-configuration-report.csv" -NoTypeInformation -Encoding UTF8
```

---

## ğŸ“‹ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†å¾Œã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### âœ… å¿…é ˆç¢ºèªé …ç›®

```
ãƒ†ãƒŠãƒ³ãƒˆåŸºæœ¬è¨­å®šï¼š
â–¡ ãƒ†ãƒŠãƒ³ãƒˆåãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šç¢ºèª
â–¡ ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»æ¨©é™è¨­å®š
â–¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæœ‰åŠ¹åŒ–
â–¡ å¤šè¦ç´ èªè¨¼è¨­å®šå®Œäº†

ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šï¼š
â–¡ ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼å®Œäº†
â–¡ DNSè¨­å®šï¼ˆMXã€SPFã€DKIMï¼‰å®Œäº†
â–¡ ãƒ¡ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ­£å¸¸å‹•ä½œ
â–¡ Autodiscoverè¨­å®šå®Œäº†

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼š
â–¡ æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼è¨­å®š
â–¡ ç›£æŸ»ãƒ­ã‚°æœ‰åŠ¹åŒ–
â–¡ ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šå®Œäº†
â–¡ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼è¨­å®š

ã‚µãƒ¼ãƒ“ã‚¹æœ‰åŠ¹åŒ–ï¼š
â–¡ Exchange Online å‹•ä½œç¢ºèª
â–¡ SharePoint Online ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
â–¡ Teams åŸºæœ¬å‹•ä½œç¢ºèª
â–¡ OneDrive åŒæœŸç¢ºèª
```

### ğŸ”„ ç¶™ç¶šçš„ãªç›£è¦–é …ç›®

**æ—¥æ¬¡ç›£è¦–é …ç›®**
```powershell
# æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹

function Daily-HealthCheck {
    $report = @()
    
    # ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒçŠ¶æ³
    $serviceHealth = Get-MgServicePrincipal | Where-Object {$_.DisplayName -like "*Office 365*"}
    $report += "ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒçŠ¶æ³: æ­£å¸¸"
    
    # æ–°è¦ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¤±æ•—
    $failedSignins = Get-MgAuditLogSignIn -Filter "status/errorCode ne 0 and createdDateTime ge $(Get-Date -Format yyyy-MM-dd)" 
    $report += "ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¤±æ•—: $($failedSignins.Count) ä»¶"
    
    # ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä½¿ç”¨çŠ¶æ³
    $skus = Get-MgSubscribedSku
    foreach ($sku in $skus) {
        $usage = [Math]::Round(($sku.ConsumedUnits / $sku.PrepaidUnits.Enabled) * 100, 1)
        $report += "ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä½¿ç”¨ç‡ ($($sku.SkuPartNumber)): $usage%"
    }
    
    return $report
}

# æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆå®Ÿè¡Œ
$dailyReport = Daily-HealthCheck
$dailyReport | ForEach-Object { Write-Host $_ }
```

**é€±æ¬¡ç›£è¦–é …ç›®**
```powershell
# é€±æ¬¡ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹

function Weekly-SecurityCheck {
    # é«˜ãƒªã‚¹ã‚¯ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã®ç¢ºèª
    $riskySigns = Get-MgIdentityConditionalAccessNamedLocation | 
                  Where-Object {$_.CreatedDateTime -ge (Get-Date).AddDays(-7)}
    
    # æ–°è¦ç®¡ç†è€…ã®ç¢ºèª
    $adminRoles = Get-MgDirectoryRole | Where-Object {$_.DisplayName -like "*Admin*"}
    
    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´çŠ¶æ³
    $passwordChanges = Get-MgAuditLogDirectoryAudit -Filter "category eq 'UserManagement' and activityDisplayName eq 'Change user password'"
    
    Write-Host "=== é€±æ¬¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆ ==="
    Write-Host "ãƒªã‚¹ã‚¯æ¤œå‡ºæ•°: $($riskySigns.Count)"
    Write-Host "ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«æ•°: $($adminRoles.Count)"
    Write-Host "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´: $($passwordChanges.Count) ä»¶"
}

# é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆå®Ÿè¡Œ
Weekly-SecurityCheck
```

---

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼å¤±æ•—

**ç—‡çŠ¶**: TXTãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã—ãŸãŒãƒ‰ãƒ¡ã‚¤ãƒ³æ¤œè¨¼ãŒé€šã‚‰ãªã„

**è§£æ±ºæ‰‹é †**:
```powershell
# DNSä¼æ’­çŠ¶æ³ã®ç¢ºèª
function Test-DNSPropagation {
    param([string]$DomainName, [string]$RecordType = "TXT")
    
    $publicDNS = @("8.8.8.8", "1.1.1.1", "208.67.222.222")
    
    foreach ($dns in $publicDNS) {
        try {
            $result = Resolve-DnsName -Name $DomainName -Type $RecordType -Server $dns -ErrorAction Stop
            Write-Host "DNS $dns : âœ… è§£æ±ºæˆåŠŸ" -ForegroundColor Green
            Write-Host "  å€¤: $($result.Strings -join ', ')"
        }
        catch {
            Write-Host "DNS $dns : âŒ è§£æ±ºå¤±æ•—" -ForegroundColor Red
        }
    }
}

# ä½¿ç”¨ä¾‹
Test-DNSPropagation -DomainName "school.edu.jp" -RecordType "TXT"
```

#### 2. ãƒ¡ãƒ¼ãƒ«é…ä¿¡å•é¡Œ

**ç—‡çŠ¶**: ãƒ¡ãƒ¼ãƒ«ãŒæ­£å¸¸ã«é…ä¿¡ã•ã‚Œãªã„

**è¨ºæ–­æ‰‹é †**:
```powershell
# ãƒ¡ãƒ¼ãƒ«é…ä¿¡ã®è¨ºæ–­

# Exchange Online ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½è·¡
# Connect-ExchangeOnline
$messageTrace = Get-MessageTrace -StartDate (Get-Date).AddHours(-24) -EndDate (Get-Date)
$messageTrace | Where-Object {$_.Status -eq "Failed"} | 
    Select-Object Received, SenderAddress, RecipientAddress, Status, Detail

# SPF/DKIMè¨­å®šã®ç¢ºèª
function Test-EmailAuthentication {
    param([string]$DomainName)
    
    # SPFç¢ºèª
    $spfRecord = Resolve-DnsName -Name $DomainName -Type TXT | 
                Where-Object {$_.Strings -match "v=spf1"}
    
    # DKIMç¢ºèª
    $dkimSelector1 = Resolve-DnsName -Name "selector1._domainkey.$DomainName" -Type CNAME
    $dkimSelector2 = Resolve-DnsName -Name "selector2._domainkey.$DomainName" -Type CNAME
    
    Write-Host "SPFè¨­å®š: $(if($spfRecord){'âœ…'}else{'âŒ'})"
    Write-Host "DKIM Selector1: $(if($dkimSelector1){'âœ…'}else{'âŒ'})"
    Write-Host "DKIM Selector2: $(if($dkimSelector2){'âœ…'}else{'âŒ'})"
}

Test-EmailAuthentication -DomainName "school.edu.jp"
```

#### 3. ã‚µã‚¤ãƒ³ã‚¤ãƒ³å•é¡Œ

**ç—‡çŠ¶**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚µã‚¤ãƒ³ã‚¤ãƒ³ã§ããªã„

**è¨ºæ–­ã¨è§£æ±º**:
```powershell
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µã‚¤ãƒ³ã‚¤ãƒ³çŠ¶æ³ã®ç¢ºèª

function Diagnose-UserSignIn {
    param([string]$UserPrincipalName)
    
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæœ¬æƒ…å ±
    $user = Get-MgUser -UserId $UserPrincipalName
    Write-Host "ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹: $(if($user.AccountEnabled){'æœ‰åŠ¹'}else{'ç„¡åŠ¹'})"
    
    # ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ³
    $licenses = $user.AssignedLicenses
    Write-Host "ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ•°: $($licenses.Count)"
    
    # æœ€è¿‘ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³å±¥æ­´
    $signIns = Get-MgAuditLogSignIn -Filter "userPrincipalName eq '$UserPrincipalName'" -Top 10
    Write-Host "ç›´è¿‘ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³è©¦è¡Œ: $($signIns.Count) ä»¶"
    
    # ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã®è©³ç´°
    $errors = $signIns | Where-Object {$_.Status.ErrorCode -ne 0}
    if ($errors) {
        Write-Host "ã‚¨ãƒ©ãƒ¼è©³ç´°:"
        $errors | ForEach-Object {
            Write-Host "  - $($_.Status.FailureReason)"
        }
    }
}

# ä½¿ç”¨ä¾‹
Diagnose-UserSignIn -UserPrincipalName "student@school.edu.jp"
```

---

## ğŸ“š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ğŸ¯ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†å¾Œã®æ¨å¥¨ä½œæ¥­

1. **[ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è¨­å®š](user-management.md)**
   - ä¸€æ‹¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
   - ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†è¨­å®š
   - ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å‰²ã‚Šå½“ã¦è‡ªå‹•åŒ–

2. **[ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–](security-management.md)**
   - æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹è©³ç´°è¨­å®š
   - ãƒ‡ãƒ¼ã‚¿æå¤±é˜²æ­¢ãƒãƒªã‚·ãƒ¼
   - è„…å¨ä¿è­·è¨­å®š

3. **[ã‚µãƒ¼ãƒ“ã‚¹å€‹åˆ¥è¨­å®š](teams-management.md)**
   - Teams for Educationè¨­å®š
   - SharePoint ã‚µã‚¤ãƒˆä½œæˆ
   - Exchange ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½

4. **[ç›£è¦–ãƒ»ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š](reports-analytics.md)**
   - åˆ©ç”¨çŠ¶æ³åˆ†æ
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

### ğŸ“– é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Microsoft 365 åŸºæœ¬æ¦‚å¿µã¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹](microsoft-365-basics-and-licensing.md)
- [æ¦‚è¦ã¨å‰ææ¡ä»¶](overview-and-prerequisites.md)
- [ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†](license-management.md)
- [Microsoft Graph PowerShell](microsoft-graph-powershell.md)

---

**âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …**

1. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**
   - è¨­å®šå¤‰æ›´å‰ã¯å¿…ãšç¾åœ¨ã®è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
   - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’äº‹å‰ã«ç¢ºèª
   - é‡è¦ãªå¤‰æ›´ã¯æ¤œè¨¼ç’°å¢ƒã§äº‹å‰ãƒ†ã‚¹ãƒˆ

2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æœ€å„ªå…ˆ**
   - ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å®šæœŸå¤‰æ›´
   - å¤šè¦ç´ èªè¨¼ã¯å…¨ç®¡ç†è€…ã§å¿…é ˆ
   - æœ€å°æ¨©é™ã®åŸå‰‡ã‚’éµå®ˆ

3. **æ®µéšçš„å°å…¥**
   - ä¸€åº¦ã«å…¨æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ã—ãªã„
   - ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®æ¤œè¨¼ã‚’æ¨å¥¨
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¨ä¸¦è¡Œå®Ÿæ–½

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å®Œäº†ã™ã‚Œã°ã€å®‰å…¨ã§åŠ¹ç‡çš„ãªMicrosoft 365ç’°å¢ƒã®åŸºç›¤ãŒæ§‹ç¯‰ã•ã‚Œã¾ã™ã€‚
