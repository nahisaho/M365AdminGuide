# OneDrive for Business å®Œå…¨ç®¡ç†ã‚¬ã‚¤ãƒ‰

## ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [å‰ææ¡ä»¶ã¨åˆæœŸè¨­å®š](#å‰ææ¡ä»¶ã¨åˆæœŸè¨­å®š)
3. [ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†](#ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†)
4. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡)
5. [åŒæœŸè¨­å®š](#åŒæœŸè¨­å®š)
6. [ç›£æŸ»ã¨ãƒ¬ãƒãƒ¼ãƒˆ](#ç›£æŸ»ã¨ãƒ¬ãƒãƒ¼ãƒˆ)
7. [å®Ÿç”¨çš„ãªç®¡ç†ã‚·ãƒŠãƒªã‚ª](#å®Ÿç”¨çš„ãªç®¡ç†ã‚·ãƒŠãƒªã‚ª)
8. [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©maã‚¯ãƒ†ã‚£ã‚¹)
9. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
10. [æ–°æ©Ÿèƒ½ã¨ä»Šå¾Œã®å±•æœ›](#æ–°æ©Ÿèƒ½ã¨ä»Šå¾Œã®å±•æœ›)

## æ¦‚è¦

OneDrive for Business ã¯ã€Microsoft 365 ç’°å¢ƒã«ãŠã‘ã‚‹å€‹äººç”¨ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç‹¬è‡ªã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’æä¾›ã—ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å«ã¿ã¾ã™ï¼š

### ä¸»è¦æ©Ÿèƒ½

- **å€‹äººãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: æœ€å¤§15TBã¾ã§ã®å®¹é‡
- **ãƒ•ã‚¡ã‚¤ãƒ«åŒæœŸ**: ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã¨ã®è‡ªå‹•åŒæœŸ
- **å¤–éƒ¨å…±æœ‰**: ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰æ©Ÿèƒ½
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: ãƒ•ã‚¡ã‚¤ãƒ«ã®å±¥æ­´ç®¡ç†
- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¢ã‚¯ã‚»ã‚¹**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãªã—ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹
- **AIçµ±åˆ**: Copilotã¨ã®é€£æºã«ã‚ˆã‚‹ç”Ÿç”£æ€§å‘ä¸Š

### æ•™è‚²æ©Ÿé–¢ã§ã®æ´»ç”¨ä¾‹

- æ•™å“¡ã®æˆæ¥­è³‡æ–™ç®¡ç†
- ç”Ÿå¾’ã®èª²é¡Œæå‡ºã¨ä¿å­˜
- å€‹äººç ”ç©¶ãƒ‡ãƒ¼ã‚¿ã®å®‰å…¨ãªä¿ç®¡
- ãƒ‡ãƒã‚¤ã‚¹é–“ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«åŒæœŸ
- å­¦ç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é…å¸ƒ

## å‰ææ¡ä»¶ã¨åˆæœŸè¨­å®š

### å¿…è¦ãªæ¨©é™

- Microsoft 365 ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…
- SharePoint ç®¡ç†è€…
- ã¾ãŸã¯ã€OneDrive ç®¡ç†è€…ã®å§”ä»»æ¨©é™

### PowerShellç’°å¢ƒã®æº–å‚™ï¼ˆ2025å¹´ç‰ˆï¼‰

```powershell
# æœ€æ–°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Install-Module -Name Microsoft.Online.SharePoint.PowerShell -Scope CurrentUser -Force -AllowClobber
Install-Module -Name Microsoft.Graph -Scope CurrentUser -Force -AllowClobber
Install-Module -Name PnP.PowerShell -Scope CurrentUser -Force -AllowClobber

# æ¥ç¶šã®ç¢ºç«‹
Connect-SPOService -Url "https://yourtenant-admin.sharepoint.com"
Connect-MgGraph -Scopes "Sites.FullControl.All", "Files.ReadWrite.All", "User.Read.All", "Group.ReadWrite.All"

# PnP PowerShellæ¥ç¶šï¼ˆé«˜åº¦ãªæ“ä½œç”¨ï¼‰
Connect-PnPOnline -Url "https://yourtenant-admin.sharepoint.com" -Interactive
```

### Microsoft Graph APIãƒ™ãƒ¼ã‚¹ã®ç®¡ç†ï¼ˆæ¨å¥¨ï¼‰

```powershell
# Microsoft Graph ã‚’ä½¿ç”¨ã—ãŸæ–°ã—ã„ç®¡ç†æ–¹æ³•
function Initialize-OneDriveManagement {
    param(
        [string]$TenantId,
        [string]$ClientId,
        [string]$ClientSecret
    )
    
    Write-Host "ğŸš€ Microsoft Graph ã§OneDriveç®¡ç†ã‚’åˆæœŸåŒ–ä¸­..." -ForegroundColor Cyan
    
    # Graph API èªè¨¼
    $secureSecret = ConvertTo-SecureString $ClientSecret -AsPlainText -Force
    $credential = New-Object System.Management.Automation.PSCredential ($ClientId, $secureSecret)
    
    Connect-MgGraph -TenantId $TenantId -ClientCredential $credential
    
    # åŸºæœ¬è¨­å®šã®ç¢ºèª
    $context = Get-MgContext
    Write-Host "âœ… æ¥ç¶šæˆåŠŸ: $($context.TenantId)" -ForegroundColor Green
    Write-Host "ğŸ“‹ ã‚¢ãƒ—ãƒªID: $($context.AppName)" -ForegroundColor White
    Write-Host "ğŸ” æ¨©é™: $($context.Scopes -join ', ')" -ForegroundColor White
    
    return $context
}

# å®Ÿè¡Œä¾‹
# $context = Initialize-OneDriveManagement -TenantId "your-tenant-id" -ClientId "your-app-id" -ClientSecret "your-secret"
```

### ãƒ†ãƒŠãƒ³ãƒˆåŸºæœ¬è¨­å®šã®ç¢ºèª

```powershell
# ç¾åœ¨ã®OneDriveè¨­å®šã‚’ç¢ºèª
function Get-OneDriveConfiguration {
    Write-Host "=== OneDrive for Business è¨­å®šçŠ¶æ³ ===" -ForegroundColor Cyan
    
    $tenant = Get-SPOTenant
    
    Write-Host "ğŸ“Š ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨­å®š:" -ForegroundColor Yellow
    Write-Host "  ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®¹é‡: $($tenant.OneDriveStorageQuota) MB" -ForegroundColor White
    Write-Host "  æœ€å¤§å®¹é‡åˆ¶é™: $($tenant.OrphanedPersonalSitesRetentionPeriod) æ—¥" -ForegroundColor White
    
    Write-Host "ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š:" -ForegroundColor Yellow
    Write-Host "  å¤–éƒ¨å…±æœ‰: $($tenant.SharingCapability)" -ForegroundColor White
    Write-Host "  ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒ³ã‚¯: $($tenant.DefaultSharingLinkType)" -ForegroundColor White
    Write-Host "  åŒ¿åãƒªãƒ³ã‚¯æœ‰åŠ¹æœŸé™: $($tenant.RequireAnonymousLinksExpireInDays) æ—¥" -ForegroundColor White
    
    Write-Host "âš™ï¸ åŒæœŸè¨­å®š:" -ForegroundColor Yellow
    Write-Host "  é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: $($tenant.ExcludedFileExtensionsForSyncClient)" -ForegroundColor White
}

Get-OneDriveConfiguration
```

## ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†

### åŸºæœ¬å®¹é‡è¨­å®š

```powershell
# ãƒ†ãƒŠãƒ³ãƒˆå…¨ä½“ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®¹é‡è¨­å®š
function Set-OneDriveStorageDefaults {
    param(
        [int]$DefaultQuotaMB = 5120,  # 5GB
        [int]$MaxQuotaMB = 25600      # 25GB
    )
    
    Write-Host "ğŸ’¾ OneDrive ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨­å®šã‚’æ§‹æˆä¸­..." -ForegroundColor Cyan
    
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®¹é‡ã®è¨­å®š
    Set-SPOTenant -OneDriveStorageQuota $DefaultQuotaMB
    
    Write-Host "âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®¹é‡: $($DefaultQuotaMB)MB ($($DefaultQuotaMB/1024)GB) ã«è¨­å®š" -ForegroundColor Green
    Write-Host "â„¹ï¸  æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªå‹•çš„ã«ã“ã®å®¹é‡ãŒé©ç”¨ã•ã‚Œã¾ã™" -ForegroundColor Blue
}

# å®Ÿè¡Œ
Set-OneDriveStorageDefaults -DefaultQuotaMB 5120
```

### å½¹å‰²åˆ¥å®¹é‡ç®¡ç†

```powershell
# æ•™è‚²æ©Ÿé–¢å‘ã‘éšå±¤åˆ¥å®¹é‡è¨­å®š
function Set-EducationOneDriveQuotas {
    Write-Host "ğŸ“ æ•™è‚²æ©Ÿé–¢å‘ã‘ OneDrive å®¹é‡è¨­å®šã‚’é©ç”¨ä¸­..." -ForegroundColor Cyan
    
    # å®¹é‡è¨­å®šã®å®šç¾©
    $quotaSettings = @{
        "ç®¡ç†è€…"   = 51200  # 50GB
        "æ•™è·å“¡"   = 25600  # 25GB  
        "ç”Ÿå¾’"     = 5120   # 5GB
        "ã‚²ã‚¹ãƒˆ"   = 1024   # 1GB
    }
    
    foreach ($role in $quotaSettings.Keys) {
        $quotaMB = $quotaSettings[$role]
        $users = Get-MgUser -Filter "jobTitle eq '$role'" -All
        
        Write-Host "ğŸ‘¥ $role ã‚°ãƒ«ãƒ¼ãƒ—ã®å‡¦ç†ä¸­ ($($users.Count) ãƒ¦ãƒ¼ã‚¶ãƒ¼)..." -ForegroundColor Yellow
        
        foreach ($user in $users) {
            $oneDriveUrl = Get-OneDriveUrlForUser -UserPrincipalName $user.UserPrincipalName
            
            if ($oneDriveUrl) {
                try {
                    Set-SPOSite -Identity $oneDriveUrl -StorageQuota $quotaMB
                    Write-Host "  âœ… $($user.UserPrincipalName): $($quotaMB)MB" -ForegroundColor Green
                }
                catch {
                    Write-Host "  âš ï¸ ã‚¹ã‚­ãƒƒãƒ—: $($user.UserPrincipalName) (OneDriveæœªä½œæˆ)" -ForegroundColor Yellow
                }
            }
        }
    }
    
    Write-Host "âœ… éšå±¤åˆ¥å®¹é‡è¨­å®šå®Œäº†" -ForegroundColor Green
}

# OneDrive URLã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
function Get-OneDriveUrlForUser {
    param([string]$UserPrincipalName)
    
    $tenant = (Get-SPOTenant).MySiteHostUrl
    $userUrl = $UserPrincipalName.Replace('@', '_').Replace('.', '_')
    return "$tenant/personal/$userUrl"
}

# å®Ÿè¡Œ
Set-EducationOneDriveQuotas
```

### å®¹é‡ä½¿ç”¨çŠ¶æ³ã®ç›£è¦–

```powershell
# OneDriveä½¿ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆ
function Get-OneDriveUsageReport {
    param(
        [string]$OutputPath = "C:\Reports\OneDriveUsage.csv"
    )
    
    Write-Host "ğŸ“Š OneDrive ä½¿ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­..." -ForegroundColor Cyan
    
    $report = @()
    $users = Get-MgUser -All
    
    foreach ($user in $users) {
        $oneDriveUrl = Get-OneDriveUrlForUser -UserPrincipalName $user.UserPrincipalName
        
        try {
            $siteInfo = Get-SPOSite -Identity $oneDriveUrl -Detailed
            
            $usageInfo = [PSCustomObject]@{
                UserPrincipalName = $user.UserPrincipalName
                DisplayName = $user.DisplayName
                JobTitle = $user.JobTitle
                OneDriveUrl = $oneDriveUrl
                StorageQuotaMB = $siteInfo.StorageQuota
                StorageUsedMB = $siteInfo.StorageUsageCurrent
                UsagePercentage = [math]::Round(($siteInfo.StorageUsageCurrent / $siteInfo.StorageQuota) * 100, 2)
                LastModified = $siteInfo.LastContentModifiedDate
                Status = if ($siteInfo.StorageUsageCurrent -gt ($siteInfo.StorageQuota * 0.9)) { "è­¦å‘Š" } else { "æ­£å¸¸" }
            }
            
            $report += $usageInfo
            Write-Host "  âœ… $($user.UserPrincipalName): $($usageInfo.UsagePercentage)% ä½¿ç”¨" -ForegroundColor Green
        }
        catch {
            Write-Host "  âš ï¸ ã‚¹ã‚­ãƒƒãƒ—: $($user.UserPrincipalName)" -ForegroundColor Yellow
        }
    }
    
    # CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    $report | Export-Csv -Path $OutputPath -NoTypeInformation -Encoding UTF8
    Write-Host "ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜: $OutputPath" -ForegroundColor Green
    
    # ã‚µãƒãƒªãƒ¼è¡¨ç¤º
    $totalUsers = $report.Count
    $warningUsers = ($report | Where-Object { $_.Status -eq "è­¦å‘Š" }).Count
    $averageUsage = [math]::Round(($report | Measure-Object UsagePercentage -Average).Average, 2)
    
    Write-Host "ğŸ“ˆ ä½¿ç”¨çŠ¶æ³ã‚µãƒãƒªãƒ¼:" -ForegroundColor Cyan
    Write-Host "  ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: $totalUsers" -ForegroundColor White
    Write-Host "  è­¦å‘Šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: $warningUsers" -ForegroundColor $(if ($warningUsers -gt 0) { "Red" } else { "Green" })
    Write-Host "  å¹³å‡ä½¿ç”¨ç‡: $averageUsage%" -ForegroundColor White
    
    return $report
}

# å®Ÿè¡Œä¾‹
$usageReport = Get-OneDriveUsageReport
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

### å¤–éƒ¨å…±æœ‰ã®åˆ¶å¾¡

```powershell
# ã‚»ã‚­ãƒ¥ã‚¢ãªå¤–éƒ¨å…±æœ‰è¨­å®š
function Set-SecureOneDriveSharing {
    Write-Host "ğŸ” OneDrive ã‚»ã‚­ãƒ¥ã‚¢å…±æœ‰è¨­å®šã‚’é©ç”¨ä¸­..." -ForegroundColor Cyan
    
    # æœ€ã‚‚å®‰å…¨ãªè¨­å®šã‚’é©ç”¨
    $secureSettings = @{
        "å¤–éƒ¨å…±æœ‰" = "ExternalUserSharingOnly"  # èªè¨¼æ¸ˆã¿å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
        "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒ³ã‚¯" = "Direct"             # ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
        "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨©é™" = "View"                # è¡¨ç¤ºã®ã¿
        "åŒ¿åãƒªãƒ³ã‚¯æœ‰åŠ¹æœŸé™" = 7                  # 7æ—¥é–“
        "ãƒ¡ãƒ¼ãƒ«èªè¨¼" = $true                     # å¿…é ˆ
        "å†èªè¨¼æœŸé–“" = 30                        # 30æ—¥é–“
    }
    
    # ãƒ†ãƒŠãƒ³ãƒˆãƒ¬ãƒ™ãƒ«è¨­å®š
    Set-SPOTenant -SharingCapability ExternalUserSharingOnly
    Set-SPOTenant -DefaultSharingLinkType Direct
    Set-SPOTenant -DefaultLinkPermission View
    Set-SPOTenant -RequireAnonymousLinksExpireInDays 7
    Set-SPOTenant -EmailAttestationRequired $true
    Set-SPOTenant -EmailAttestationReAuthDays 30
    
    # å±é™ºãªæ©Ÿèƒ½ã®ç„¡åŠ¹åŒ–
    Set-SPOTenant -OneDriveForGuestsEnabled $false
    Set-SPOTenant -FileAnonymousLinkType Disabled
    Set-SPOTenant -FolderAnonymousLinkType Disabled
    
    Write-Host "âœ… ã‚»ã‚­ãƒ¥ã‚¢å…±æœ‰è¨­å®šå®Œäº†" -ForegroundColor Green
    
    foreach ($setting in $secureSettings.GetEnumerator()) {
        Write-Host "  $($setting.Key): $($setting.Value)" -ForegroundColor White
    }
}

# å®Ÿè¡Œ
Set-SecureOneDriveSharing
```

### æ•™è‚²æ©Ÿé–¢å‘ã‘æ®µéšçš„åˆ¶é™

```powershell
# æ•™è‚²æ©Ÿé–¢å‘ã‘ãƒ¦ãƒ¼ã‚¶ãƒ¼éšå±¤åˆ¥å…±æœ‰åˆ¶å¾¡
function Set-EducationOneDriveSharingByRole {
    Write-Host "ğŸ“ æ•™è‚²æ©Ÿé–¢å‘ã‘éšå±¤åˆ¥å…±æœ‰åˆ¶å¾¡ã‚’è¨­å®šä¸­..." -ForegroundColor Cyan
    
    # å½¹å‰²åˆ¥å…±æœ‰è¨­å®š
    $sharingPolicies = @{
        "ç”Ÿå¾’" = @{
            Capability = "Disabled"
            Description = "å…±æœ‰å®Œå…¨ç„¡åŠ¹"
        }
        "æ•™è·å“¡" = @{
            Capability = "ExternalUserSharingOnly"
            Description = "èªè¨¼æ¸ˆã¿å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿"
        }
        "ç®¡ç†è€…" = @{
            Capability = "ExternalUserAndGuestSharing"
            Description = "åˆ¶é™ä»˜ãå¤–éƒ¨å…±æœ‰"
        }
    }
    
    foreach ($role in $sharingPolicies.Keys) {
        $policy = $sharingPolicies[$role]
        $users = Get-MgUser -Filter "jobTitle eq '$role'" -All
        
        Write-Host "ğŸ‘¥ $role ã®å…±æœ‰è¨­å®šé©ç”¨ä¸­ ($($users.Count) ãƒ¦ãƒ¼ã‚¶ãƒ¼)..." -ForegroundColor Yellow
        Write-Host "   è¨­å®š: $($policy.Description)" -ForegroundColor Blue
        
        foreach ($user in $users) {
            $oneDriveUrl = Get-OneDriveUrlForUser -UserPrincipalName $user.UserPrincipalName
            
            try {
                Set-SPOSite -Identity $oneDriveUrl -SharingCapability $policy.Capability
                Write-Host "  âœ… $($user.UserPrincipalName)" -ForegroundColor Green
            }
            catch {
                Write-Host "  âš ï¸ ã‚¹ã‚­ãƒƒãƒ—: $($user.UserPrincipalName)" -ForegroundColor Yellow
            }
        }
    }
    
    Write-Host "âœ… éšå±¤åˆ¥å…±æœ‰åˆ¶å¾¡è¨­å®šå®Œäº†" -ForegroundColor Green
}

# å®Ÿè¡Œ
Set-EducationOneDriveSharingByRole
```

### æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹è¨­å®š

```powershell
# æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã‚‹ãƒ‡ãƒã‚¤ã‚¹åˆ¶é™
function Set-OneDriveConditionalAccess {
    Write-Host "ğŸ›¡ï¸ OneDrive æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹è¨­å®šä¸­..." -ForegroundColor Cyan
    
    # ç®¡ç†ã•ã‚Œã¦ã„ãªã„ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã®åˆ¶é™
    Set-SPOTenant -ConditionalAccessPolicy AllowLimitedAccess
    Set-SPOTenant -LimitedAccessFileType WebPreviewableFiles
    
    # ä¿¡é ¼ã§ããªã„å ´æ‰€ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
    Set-SPOTenant -ApplyAppEnforcedRestrictionsToAdHocRecipients $true
    
    # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰åˆ¶é™ã®è©³ç´°è¨­å®š
    $restrictionSettings = @{
        "åˆ¶é™å¯¾è±¡" = "ç®¡ç†ã•ã‚Œã¦ã„ãªã„ãƒ‡ãƒã‚¤ã‚¹"
        "è¨±å¯æ“ä½œ" = "Webãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã¿"
        "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" = "ãƒ–ãƒ­ãƒƒã‚¯"
        "å°åˆ·" = "ãƒ–ãƒ­ãƒƒã‚¯"
        "ã‚³ãƒ”ãƒ¼" = "ãƒ–ãƒ­ãƒƒã‚¯"
    }
    
    Write-Host "âœ… æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹è¨­å®šå®Œäº†" -ForegroundColor Green
    
    foreach ($setting in $restrictionSettings.GetEnumerator()) {
        Write-Host "  $($setting.Key): $($setting.Value)" -ForegroundColor White
    }
}

# å®Ÿè¡Œ
Set-OneDriveConditionalAccess
```

## åŒæœŸè¨­å®š

### åŒæœŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆ¶å¾¡

```powershell
# OneDriveåŒæœŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
function Set-OneDriveSyncSecurity {
    Write-Host "ğŸ”„ OneDrive åŒæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šä¸­..." -ForegroundColor Cyan
    
    # å±é™ºãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®åŒæœŸé™¤å¤–
    $excludedExtensions = @(
        "exe", "bat", "cmd", "scr", "msi", "vbs", "js", "jar", "com", "pif"
    )
    
    Set-SPOTenant -ExcludedFileExtensionsForSyncClient ($excludedExtensions -join ",")
    
    # ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶é™ï¼ˆçµ„ç¹”ç®¡ç†ãƒ‡ãƒã‚¤ã‚¹ã®ã¿åŒæœŸè¨±å¯ï¼‰
    # æ³¨æ„: ã“ã®è¨­å®šã«ã¯ Azure AD Device Management ãŒå¿…è¦
    try {
        Set-SPOTenant -AllowDownloadingNonWebViewableFiles $false
        Write-Host "  âœ… éWebãƒ“ãƒ¥ãƒ¼å¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰åˆ¶é™" -ForegroundColor Green
    }
    catch {
        Write-Host "  âš ï¸ ä¸€éƒ¨è¨­å®šã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸï¼ˆæ¨©é™ä¸è¶³ï¼‰" -ForegroundColor Yellow
    }
    
    # åŒæœŸåˆ¶é™ã®ç¢ºèª
    Write-Host "ğŸ“‹ åŒæœŸåˆ¶é™è¨­å®š:" -ForegroundColor Yellow
    Write-Host "  é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: $($excludedExtensions -join ', ')" -ForegroundColor White
    Write-Host "  ç®¡ç†å¯¾è±¡: çµ„ç¹”ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã¿" -ForegroundColor White
    
    Write-Host "âœ… åŒæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šå®Œäº†" -ForegroundColor Green
}

# å®Ÿè¡Œ
Set-OneDriveSyncSecurity
```

### å¸¯åŸŸå¹…åˆ¶å¾¡

```powershell
# OneDriveåŒæœŸã®å¸¯åŸŸå¹…åˆ¶å¾¡ï¼ˆGroup Policyã¾ãŸã¯ãƒ¬ã‚¸ã‚¹ãƒˆãƒªï¼‰
function Set-OneDriveBandwidthControl {
    Write-Host "ğŸ“¶ OneDrive å¸¯åŸŸå¹…åˆ¶å¾¡è¨­å®šã‚¬ã‚¤ãƒ‰" -ForegroundColor Cyan
    
    $bandwidthSettings = @"
OneDriveåŒæœŸã®å¸¯åŸŸå¹…åˆ¶å¾¡ã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ã§è¨­å®šã§ãã¾ã™ï¼š

1. Group Policyè¨­å®š:
   - ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®æ§‹æˆ > ãƒãƒªã‚·ãƒ¼ > ç®¡ç†ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
   - OneDrive > ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ > å¸¯åŸŸå¹…ã®åˆ¶é™

2. ãƒ¬ã‚¸ã‚¹ãƒˆãƒªè¨­å®š:
   ã‚­ãƒ¼: HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\OneDrive
   å€¤: UploadBandwidthLimit (KB/s)
   å€¤: DownloadBandwidthLimit (KB/s)

3. æ¨å¥¨è¨­å®š:
   - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰åˆ¶é™: 512 KB/s (ãƒ”ãƒ¼ã‚¯æ™‚é–“)
   - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰åˆ¶é™: 1024 KB/s (ãƒ”ãƒ¼ã‚¯æ™‚é–“)
   - éãƒ”ãƒ¼ã‚¯æ™‚é–“: åˆ¶é™ãªã—

4. PowerShellçµŒç”±ã§ã®ä¸€æ‹¬è¨­å®šï¼ˆè¦ç®¡ç†è€…æ¨©é™ï¼‰:
"@
    
    Write-Host $bandwidthSettings -ForegroundColor White
    
    # ã‚µãƒ³ãƒ—ãƒ«è¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    $sampleScript = @"
# ãƒ¬ã‚¸ã‚¹ãƒˆãƒªè¨­å®šä¾‹ï¼ˆå„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§å®Ÿè¡Œï¼‰
`$registryPath = "HKLM:\SOFTWARE\Policies\Microsoft\OneDrive"
if (!(Test-Path `$registryPath)) {
    New-Item -Path `$registryPath -Force
}
Set-ItemProperty -Path `$registryPath -Name "UploadBandwidthLimit" -Value 512
Set-ItemProperty -Path `$registryPath -Name "DownloadBandwidthLimit" -Value 1024
"@
    
    Write-Host "ğŸ“„ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹:" -ForegroundColor Yellow
    Write-Host $sampleScript -ForegroundColor Green
}

# å®Ÿè¡Œ
Set-OneDriveBandwidthControl
```

## ç›£æŸ»ã¨ãƒ¬ãƒãƒ¼ãƒˆ

### æ´»å‹•ç›£æŸ»ã®è¨­å®š

```powershell
# OneDriveæ´»å‹•ã®ç›£æŸ»è¨­å®š
function Enable-OneDriveAuditing {
    Write-Host "ğŸ“‹ OneDrive ç›£æŸ»è¨­å®šã‚’æœ‰åŠ¹åŒ–ä¸­..." -ForegroundColor Cyan
    
    # ç›£æŸ»ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–
    Set-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $true
    
    # ç›£æŸ»å¯¾è±¡ã®æ´»å‹•
    $auditActivities = @(
        "FileAccessed",
        "FileDownloaded", 
        "FileUploaded",
        "FileDeleted",
        "FileShared",
        "SharingLinkCreated",
        "SharingInvitationCreated"
    )
    
    Write-Host "âœ… ç›£æŸ»è¨­å®šå®Œäº†" -ForegroundColor Green
    Write-Host "ğŸ“Š ç›£æŸ»å¯¾è±¡æ´»å‹•:" -ForegroundColor Yellow
    
    foreach ($activity in $auditActivities) {
        Write-Host "  - $activity" -ForegroundColor White
    }
    
    Write-Host "â„¹ï¸  ç›£æŸ»ãƒ­ã‚°ã¯ Microsoft 365 ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã§ç¢ºèªã§ãã¾ã™" -ForegroundColor Blue
}

# å®Ÿè¡Œ
Enable-OneDriveAuditing
```

### å…±æœ‰ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ

```powershell
# OneDriveå¤–éƒ¨å…±æœ‰ãƒ¬ãƒãƒ¼ãƒˆ
function Get-OneDriveExternalSharingReport {
    param(
        [string]$OutputPath = "C:\Reports\OneDriveExternalSharing.csv",
        [int]$DaysBack = 30
    )
    
    Write-Host "ğŸ” OneDrive å¤–éƒ¨å…±æœ‰ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­..." -ForegroundColor Cyan
    
    $startDate = (Get-Date).AddDays(-$DaysBack).ToString("yyyy-MM-dd")
    $endDate = (Get-Date).ToString("yyyy-MM-dd")
    
    # çµ±åˆç›£æŸ»ãƒ­ã‚°ã‹ã‚‰å¤–éƒ¨å…±æœ‰æ´»å‹•ã‚’æ¤œç´¢
    $auditRecords = Search-UnifiedAuditLog -StartDate $startDate -EndDate $endDate `
        -Operations "SharingInvitationCreated,AnonymousLinkCreated,SecureLinkCreated" `
        -RecordType SharePointFileOperation
    
    $sharingReport = @()
    
    foreach ($record in $auditRecords) {
        $auditData = $record.AuditData | ConvertFrom-Json
        
        if ($auditData.Workload -eq "OneDrive") {
            $sharingInfo = [PSCustomObject]@{
                Date = $record.CreationDate
                User = $auditData.UserId
                Activity = $auditData.Operation
                FileName = $auditData.ObjectId
                ExternalUser = $auditData.TargetUserOrGroupName
                SharingType = $auditData.EventData.SharingType
                ClientIP = $auditData.ClientIP
                UserAgent = $auditData.UserAgent
            }
            
            $sharingReport += $sharingInfo
        }
    }
    
    # ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
    $sharingReport | Export-Csv -Path $OutputPath -NoTypeInformation -Encoding UTF8
    
    # ã‚µãƒãƒªãƒ¼è¡¨ç¤º
    $totalSharing = $sharingReport.Count
    $uniqueUsers = ($sharingReport | Group-Object User).Count
    $externalSharing = ($sharingReport | Where-Object { $_.ExternalUser -notlike "*@yourdomain.com" }).Count
    
    Write-Host "ğŸ“Š å¤–éƒ¨å…±æœ‰ã‚µãƒãƒªãƒ¼ (éå»$DaysBackæ—¥é–“):" -ForegroundColor Cyan
    Write-Host "  ç·å…±æœ‰æ•°: $totalSharing" -ForegroundColor White
    Write-Host "  å…±æœ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: $uniqueUsers" -ForegroundColor White  
    Write-Host "  å¤–éƒ¨å…±æœ‰æ•°: $externalSharing" -ForegroundColor $(if ($externalSharing -gt 0) { "Red" } else { "Green" })
    Write-Host "ğŸ“„ è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ: $OutputPath" -ForegroundColor Green
    
    return $sharingReport
}

# å®Ÿè¡Œä¾‹
$sharingReport = Get-OneDriveExternalSharingReport -DaysBack 30
```

## å®Ÿç”¨çš„ãªç®¡ç†ã‚·ãƒŠãƒªã‚ª

### æ–°å…¥ç¤¾å“¡ãƒ»æ–°å…¥ç”Ÿã®OneDriveã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```powershell
# æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®è‡ªå‹•OneDriveãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°
function Initialize-NewUserOneDrive {
    param(
        [string]$UserPrincipalName,
        [string]$UserRole = "ç”Ÿå¾’", # ç”Ÿå¾’ã€æ•™è·å“¡ã€ç®¡ç†è€…
        [int]$StorageQuotaMB = 2048, # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ2GB
        [bool]$EnableExternalSharing = $false
    )
    
    Write-Host "ğŸ‘¤ æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼OneDriveè¨­å®šä¸­: $UserPrincipalName" -ForegroundColor Cyan
    
    try {
        # 1. OneDriveã‚µã‚¤ãƒˆã®äº‹å‰ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°
        Request-SPOPersonalSite -UserEmails @($UserPrincipalName)
        Write-Host "âœ… OneDriveã‚µã‚¤ãƒˆãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°è¦æ±‚é€ä¿¡" -ForegroundColor Green
        
        # 2. å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚µã‚¤ãƒˆURLæ§‹ç¯‰
        Start-Sleep -Seconds 30
        $oneDriveUrl = Get-OneDriveUrlForUser -UserPrincipalName $UserPrincipalName
        
        # 3. å½¹å‰²ã«å¿œã˜ãŸå®¹é‡è¨­å®š
        $quotaSettings = @{
            "ç”Ÿå¾’" = 2048      # 2GB
            "æ•™è·å“¡" = 10240   # 10GB
            "ç®¡ç†è€…" = 51200   # 50GB
        }
        
        $actualQuota = $quotaSettings[$UserRole]
        if ($actualQuota) {
            Set-SPOSite -Identity $oneDriveUrl -StorageQuota $actualQuota
            Write-Host "âœ… ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡è¨­å®š: $($actualQuota)MB" -ForegroundColor Green
        }
        
        # 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
        if (-not $EnableExternalSharing) {
            Set-SPOSite -Identity $oneDriveUrl -SharingCapability Disabled
            Write-Host "âœ… å¤–éƒ¨å…±æœ‰ç„¡åŠ¹åŒ–å®Œäº†" -ForegroundColor Green
        }
        
        # 5. è¨­å®šç¢ºèª
        $siteInfo = Get-SPOSite -Identity $oneDriveUrl -Detailed
        
        Write-Host "ğŸ“‹ è¨­å®šã‚µãƒãƒªãƒ¼:" -ForegroundColor Yellow
        Write-Host "  ãƒ¦ãƒ¼ã‚¶ãƒ¼: $UserPrincipalName" -ForegroundColor White
        Write-Host "  å½¹å‰²: $UserRole" -ForegroundColor White
        Write-Host "  å®¹é‡: $($siteInfo.StorageQuota)MB" -ForegroundColor White
        Write-Host "  å…±æœ‰è¨­å®š: $($siteInfo.SharingCapability)" -ForegroundColor White
        Write-Host "  URL: $($siteInfo.Url)" -ForegroundColor White
        
        return $siteInfo
    }
    catch {
        Write-Host "âŒ ã‚¨ãƒ©ãƒ¼: $($_.Exception.Message)" -ForegroundColor Red
        return $null
    }
}

# ä¸€æ‹¬æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
function Bulk-InitializeNewUsersOneDrive {
    param(
        [string]$CsvPath = ".\new_users.csv" # UserPrincipalName,Role ã®å½¢å¼
    )
    
    Write-Host "ğŸ“Š ä¸€æ‹¬æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼OneDriveè¨­å®šé–‹å§‹" -ForegroundColor Cyan
    
    $users = Import-Csv -Path $CsvPath
    $successCount = 0
    $errorCount = 0
    
    foreach ($user in $users) {
        $result = Initialize-NewUserOneDrive -UserPrincipalName $user.UserPrincipalName -UserRole $user.Role
        
        if ($result) {
            $successCount++
        } else {
            $errorCount++
        }
        
        # ãƒ¬ãƒ¼ãƒˆåˆ¶é™å›é¿
        Start-Sleep -Seconds 2
    }
    
    Write-Host "ğŸ“ˆ ä¸€æ‹¬è¨­å®šå®Œäº†:" -ForegroundColor Cyan
    Write-Host "  æˆåŠŸ: $successCount ãƒ¦ãƒ¼ã‚¶ãƒ¼" -ForegroundColor Green
    Write-Host "  å¤±æ•—: $errorCount ãƒ¦ãƒ¼ã‚¶ãƒ¼" -ForegroundColor Red
}

# å®Ÿè¡Œä¾‹
# Initialize-NewUserOneDrive -UserPrincipalName "newstudent@school.edu" -UserRole "ç”Ÿå¾’"
# Bulk-InitializeNewUsersOneDrive -CsvPath ".\new_students_2025.csv"
```

### å­¦æœŸæœ«ãƒ»å¹´åº¦æœ«ã®ãƒ‡ãƒ¼ã‚¿æ•´ç†

```powershell
# å’æ¥­ç”Ÿãƒ»é€€è·è€…ã®OneDriveã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
function Archive-LeavingUsersOneDrive {
    param(
        [string[]]$LeavingUsers = @(),
        [string]$ArchiveLocation = "https://contoso.sharepoint.com/sites/archive",
        [int]$GracePeriodDays = 30,
        [switch]$WhatIf = $true
    )
    
    Write-Host "ğŸ“¦ é€€è·ãƒ»å’æ¥­ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®OneDriveã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‡¦ç†" -ForegroundColor Cyan
    
    foreach ($userEmail in $LeavingUsers) {
        Write-Host "ğŸ‘¤ å‡¦ç†ä¸­: $userEmail" -ForegroundColor Yellow
        
        try {
            $oneDriveUrl = Get-OneDriveUrlForUser -UserPrincipalName $userEmail
            $siteInfo = Get-SPOSite -Identity $oneDriveUrl -Detailed
            
            # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æƒ…å ±
            $archiveInfo = @{
                User = $userEmail
                OneDriveUrl = $oneDriveUrl
                StorageUsed = $siteInfo.StorageUsageCurrent
                LastModified = $siteInfo.LastContentModifiedDate
                ArchiveDate = (Get-Date).AddDays($GracePeriodDays)
            }
            
            if ($WhatIf) {
                Write-Host "  [WhatIf] ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–äºˆå®š:" -ForegroundColor Cyan
                Write-Host "    ä½¿ç”¨å®¹é‡: $($archiveInfo.StorageUsed)MB" -ForegroundColor White
                Write-Host "    æœ€çµ‚æ›´æ–°: $($archiveInfo.LastModified)" -ForegroundColor White
                Write-Host "    ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ—¥: $($archiveInfo.ArchiveDate)" -ForegroundColor White
            } else {
                # å®Ÿéš›ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‡¦ç†
                
                # 1. ã‚µã‚¤ãƒˆã‚’èª­ã¿å–ã‚Šå°‚ç”¨ã«è¨­å®š
                Set-SPOSite -Identity $oneDriveUrl -LockState ReadOnly
                Write-Host "  âœ… ã‚µã‚¤ãƒˆã‚’èª­ã¿å–ã‚Šå°‚ç”¨ã«è¨­å®š" -ForegroundColor Green
                
                # 2. ç®¡ç†è€…ã‚’ã‚µã‚¤ãƒˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†è€…ã«è¿½åŠ 
                Set-SPOUser -Site $oneDriveUrl -LoginName "admin@contoso.com" -IsSiteCollectionAdmin $true
                
                # 3. ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–è¨˜éŒ²ã®ä½œæˆ
                $archiveRecord = "ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ—¥: $(Get-Date), ãƒ¦ãƒ¼ã‚¶ãƒ¼: $userEmail, å®¹é‡: $($archiveInfo.StorageUsed)MB"
                $archiveRecord | Out-File -FilePath ".\onedrive_archive_log.txt" -Append
                
                Write-Host "  âœ… ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‡¦ç†å®Œäº†" -ForegroundColor Green
            }
        }
        catch {
            Write-Host "  âŒ ã‚¨ãƒ©ãƒ¼: $($_.Exception.Message)" -ForegroundColor Red
        }
    }
}

# ä½¿ç”¨ä¾‹
$graduatingStudents = @("student1@school.edu", "student2@school.edu")
Archive-LeavingUsersOneDrive -LeavingUsers $graduatingStudents -WhatIf $true
```

### ç·Šæ€¥æ™‚ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

```powershell
# ç·Šæ€¥æ™‚ã®ä¸€æ™‚çš„ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
function Set-EmergencyOneDriveRestrictions {
    param(
        [string]$Reason = "ç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œ",
        [switch]$DisableExternalSharing = $true,
        [switch]$BlockDownloads = $true,
        [switch]$EnableAuditMode = $true,
        [switch]$WhatIf = $false
    )
    
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    Write-Host "ğŸš¨ ç·Šæ€¥OneDriveã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™é©ç”¨ä¸­..." -ForegroundColor Red
    Write-Host "ğŸ“ ç†ç”±: $Reason" -ForegroundColor Yellow
    Write-Host "â° å®Ÿè¡Œæ™‚åˆ»: $timestamp" -ForegroundColor Yellow
    
    $emergencyActions = @()
    
    if ($DisableExternalSharing) {
        $action = "å¤–éƒ¨å…±æœ‰ã®ç„¡åŠ¹åŒ–"
        if ($WhatIf) {
            Write-Host "  [WhatIf] $action" -ForegroundColor Cyan
        } else {
            Set-SPOTenant -SharingCapability Disabled
            Write-Host "  âœ… $action å®Œäº†" -ForegroundColor Green
        }
        $emergencyActions += $action
    }
    
    if ($BlockDownloads) {
        $action = "ç®¡ç†ã•ã‚Œã¦ã„ãªã„ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰åˆ¶é™"
        if ($WhatIf) {
            Write-Host "  [WhatIf] $action" -ForegroundColor Cyan
        } else {
            Set-SPOTenant -ConditionalAccessPolicy AllowLimitedAccess
            Set-SPOTenant -LimitedAccessFileType WebPreviewableFiles
            Write-Host "  âœ… $action å®Œäº†" -ForegroundColor Green
        }
        $emergencyActions += $action
    }
    
    if ($EnableAuditMode) {
        $action = "è©³ç´°ç›£æŸ»ãƒ¢ãƒ¼ãƒ‰ã®æœ‰åŠ¹åŒ–"
        if ($WhatIf) {
            Write-Host "  [WhatIf] $action" -ForegroundColor Cyan
        } else {
            # ç›£æŸ»ãƒ­ã‚°ã®å¼·åŒ–
            Set-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $true
            Write-Host "  âœ… $action å®Œäº†" -ForegroundColor Green
        }
        $emergencyActions += $action
    }
    
    # ç·Šæ€¥å¯¾å¿œãƒ­ã‚°ã®è¨˜éŒ²
    $emergencyLog = @"
=== OneDrive ç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œãƒ­ã‚° ===
å®Ÿè¡Œæ—¥æ™‚: $timestamp
ç†ç”±: $Reason
å®Ÿè¡Œè€…: $env:USERNAME
é©ç”¨ã—ãŸåˆ¶é™:
$(($emergencyActions | ForEach-Object { "- $_" }) -join "`n")

å¾©æ—§æ‰‹é †:
1. Set-SPOTenant -SharingCapability ExternalUserSharingOnly
2. Set-SPOTenant -ConditionalAccessPolicy AllowFullAccess
3. é–¢ä¿‚è€…ã¸ã®å¾©æ—§é€šçŸ¥

===========================================
"@
    
    $emergencyLog | Out-File -FilePath ".\emergency_onedrive_actions.log" -Append
    
    Write-Host "ğŸ“‹ ç·Šæ€¥å¯¾å¿œå®Œäº†ã€‚ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: .\emergency_onedrive_actions.log" -ForegroundColor Green
    Write-Host "âš ï¸ å¾©æ—§æ™‚ã¯å¿…ãšãƒ­ã‚°ã‚’å‚ç…§ã—ã¦ãã ã•ã„" -ForegroundColor Yellow
}

# ä½¿ç”¨ä¾‹
# Set-EmergencyOneDriveRestrictions -Reason "ãƒ‡ãƒ¼ã‚¿æ¼æ´©ç–‘ã„èª¿æŸ»" -WhatIf $true
```

### å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®è‡ªå‹•åŒ–

```powershell
# é€±æ¬¡OneDriveãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
function Start-WeeklyOneDriveHealthCheck {
    param(
        [string]$ReportPath = ".\OneDrive_Weekly_Report_$(Get-Date -Format 'yyyyMMdd').html"
    )
    
    Write-Host "ğŸ” é€±æ¬¡OneDriveãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯é–‹å§‹..." -ForegroundColor Cyan
    
    # 1. åŸºæœ¬çµ±è¨ˆã®åé›†
    $tenantInfo = Get-SPOTenant
    $allOneDriveSites = Get-SPOSite -IncludePersonalSite $true -Limit All -Filter "Url -like '*-my.sharepoint.com/personal/*'"
    
    $healthMetrics = @{
        CheckDate = Get-Date
        TotalOneDriveUsers = $allOneDriveSites.Count
        TotalStorageUsed = ($allOneDriveSites | Measure-Object StorageUsageCurrent -Sum).Sum
        TotalStorageQuota = ($allOneDriveSites | Measure-Object StorageQuota -Sum).Sum
        HighUsageUsers = ($allOneDriveSites | Where-Object { ($_.StorageUsageCurrent / $_.StorageQuota) -gt 0.9 }).Count
        ExternalSharingEnabled = ($allOneDriveSites | Where-Object { $_.SharingCapability -ne "Disabled" }).Count
        InactiveUsers = ($allOneDriveSites | Where-Object { $_.LastContentModifiedDate -lt (Get-Date).AddDays(-30) }).Count
    }
    
    # 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
    $securityIssues = @()
    
    # å¤–éƒ¨å…±æœ‰ãƒã‚§ãƒƒã‚¯
    $externalSharingSites = $allOneDriveSites | Where-Object { $_.SharingCapability -ne "Disabled" }
    if ($externalSharingSites.Count -gt 0) {
        $securityIssues += "å¤–éƒ¨å…±æœ‰ãŒæœ‰åŠ¹ãªOneDriveã‚µã‚¤ãƒˆ: $($externalSharingSites.Count)ä»¶"
    }
    
    # å®¹é‡è­¦å‘Šãƒã‚§ãƒƒã‚¯
    $highUsageSites = $allOneDriveSites | Where-Object { ($_.StorageUsageCurrent / $_.StorageQuota) -gt 0.9 }
    if ($highUsageSites.Count -gt 0) {
        $securityIssues += "å®¹é‡ä½¿ç”¨ç‡90%è¶…é: $($highUsageSites.Count)ãƒ¦ãƒ¼ã‚¶ãƒ¼"
    }
    
    # 3. HTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
    $htmlReport = @"
<!DOCTYPE html>
<html>
<head>
    <title>OneDrive for Business é€±æ¬¡ãƒ˜ãƒ«ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background-color: #0078d4; color: white; padding: 20px; border-radius: 5px; }
        .metric { background-color: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; padding: 10px; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š OneDrive for Business é€±æ¬¡ãƒ˜ãƒ«ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ</h1>
        <p>ç”Ÿæˆæ—¥æ™‚: $($healthMetrics.CheckDate)</p>
    </div>
    
    <div class="metric">
        <h2>ğŸ“ˆ åŸºæœ¬çµ±è¨ˆ</h2>
        <table>
            <tr><th>é …ç›®</th><th>å€¤</th></tr>
            <tr><td>ç·OneDriveãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</td><td>$($healthMetrics.TotalOneDriveUsers)</td></tr>
            <tr><td>ç·ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡</td><td>$([math]::Round($healthMetrics.TotalStorageUsed/1024, 2)) GB</td></tr>
            <tr><td>ç·ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡</td><td>$([math]::Round($healthMetrics.TotalStorageQuota/1024, 2)) GB</td></tr>
            <tr><td>å…¨ä½“ä½¿ç”¨ç‡</td><td>$([math]::Round(($healthMetrics.TotalStorageUsed/$healthMetrics.TotalStorageQuota)*100, 1))%</td></tr>
        </table>
    </div>
    
    <div class="metric">
        <h2>âš ï¸ æ³¨æ„äº‹é …</h2>
        <ul>
            <li>å®¹é‡ä½¿ç”¨ç‡90%è¶…éãƒ¦ãƒ¼ã‚¶ãƒ¼: $($healthMetrics.HighUsageUsers)äºº</li>
            <li>å¤–éƒ¨å…±æœ‰æœ‰åŠ¹ã‚µã‚¤ãƒˆ: $($healthMetrics.ExternalSharingEnabled)ä»¶</li>
            <li>30æ—¥é–“éæ´»å‹•ãƒ¦ãƒ¼ã‚¶ãƒ¼: $($healthMetrics.InactiveUsers)äºº</li>
        </ul>
    </div>
    
    $(if ($securityIssues.Count -gt 0) {
        '<div class="warning"><h2>ğŸš¨ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Š</h2><ul>' + 
        ($securityIssues | ForEach-Object { "<li>$_</li>" }) -join '' + 
        '</ul></div>'
    } else {
        '<div class="success"><h2>âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ³è‰¯å¥½</h2><p>é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚</p></div>'
    })
    
    <div class="metric">
        <h2>ğŸ“‹ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
        <ul>
            <li>å®¹é‡ä½¿ç”¨ç‡ã®é«˜ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é€šçŸ¥</li>
            <li>éæ´»å‹•ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¢ºèªã¨ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ¤œè¨</li>
            <li>å¤–éƒ¨å…±æœ‰ã®å¦¥å½“æ€§ç¢ºèª</li>
            <li>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®éµå®ˆçŠ¶æ³ç¢ºèª</li>
        </ul>
    </div>
</body>
</html>
"@
    
    # ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜
    $htmlReport | Out-File -FilePath $ReportPath -Encoding UTF8
    
    Write-Host "âœ… é€±æ¬¡ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Œäº†" -ForegroundColor Green
    Write-Host "ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜: $ReportPath" -ForegroundColor Green
    
    # é‡è¦ãªè­¦å‘ŠãŒã‚ã‚Œã°è¡¨ç¤º
    if ($securityIssues.Count -gt 0) {
        Write-Host "âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘ŠãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ:" -ForegroundColor Yellow
        $securityIssues | ForEach-Object { Write-Host "  - $_" -ForegroundColor Red }
    }
    
    return $healthMetrics
}

# ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã§ã®è‡ªå‹•å®Ÿè¡Œè¨­å®šä¾‹
function Register-OneDriveWeeklyTask {
    $taskName = "OneDriveé€±æ¬¡ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯"
    $scriptPath = "C:\Scripts\OneDriveHealthCheck.ps1"
    
    # PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
    $scriptContent = @"
Import-Module Microsoft.Online.SharePoint.PowerShell
Connect-SPOService -Url "https://yourtenant-admin.sharepoint.com"
Start-WeeklyOneDriveHealthCheck
"@
    
    $scriptContent | Out-File -FilePath $scriptPath -Encoding UTF8
    
    # ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã¸ã®ç™»éŒ²
    $action = New-ScheduledTaskAction -Execute "PowerShell.exe" -Argument "-File `"$scriptPath`""
    $trigger = New-ScheduledTaskTrigger -Weekly -DaysOfWeek Monday -At "6:00AM"
    $settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries
    
    Register-ScheduledTask -TaskName $taskName -Action $action -Trigger $trigger -Settings $settings -Description "OneDrive for Business é€±æ¬¡ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯"
    
    Write-Host "âœ… é€±æ¬¡ã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ²ã—ã¾ã—ãŸ: $taskName" -ForegroundColor Green
}

# å®Ÿè¡Œä¾‹
# $healthReport = Start-WeeklyOneDriveHealthCheck
# Register-OneDriveWeeklyTask
```

## æ–°æ©Ÿèƒ½ã¨ä»Šå¾Œã®å±•æœ›

### Microsoft 365 Copilotçµ±åˆ

```powershell
# Copilotçµ±åˆã®æº–å‚™ã¨è¨­å®š
function Enable-OneDriveCopilotIntegration {
    param(
        [bool]$EnableDataProcessing = $true,
        [string[]]$AllowedUsers = @(),
        [switch]$WhatIf = $true
    )
    
    Write-Host "ğŸ¤– OneDrive Copilotçµ±åˆè¨­å®šä¸­..." -ForegroundColor Cyan
    
    if ($WhatIf) {
        Write-Host "  [WhatIf] Copilotãƒ‡ãƒ¼ã‚¿å‡¦ç†: $EnableDataProcessing" -ForegroundColor Cyan
        Write-Host "  [WhatIf] å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: $($AllowedUsers.Count)" -ForegroundColor Cyan
    } else {
        # å®Ÿéš›ã®è¨­å®šã¯Microsoft 365ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ã¾ãŸã¯Graph APIã§å®Ÿè¡Œ
        Write-Host "ğŸ’¡ Copilotçµ±åˆã¯ä»¥ä¸‹ã§è¨­å®šã—ã¦ãã ã•ã„:" -ForegroundColor Yellow
        Write-Host "  1. Microsoft 365ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ > è¨­å®š > Copilot" -ForegroundColor White
        Write-Host "  2. OneDriveãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’è¨­å®š" -ForegroundColor White
        Write-Host "  3. ãƒ¦ãƒ¼ã‚¶ãƒ¼å˜ä½ã§ã®Copilotãƒ©ã‚¤ã‚»ãƒ³ã‚¹å‰²ã‚Šå½“ã¦" -ForegroundColor White
    }
}

# å®Ÿè¡Œä¾‹
# Enable-OneDriveCopilotIntegration -WhatIf $true
```

### ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆå¯¾å¿œ

```powershell
# OneDriveã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
function Implement-OneDriveZeroTrust {
    Write-Host "ğŸ›¡ï¸ OneDrive ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…ä¸­..." -ForegroundColor Cyan
    
    # 1. ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
    Write-Host "ğŸ“± ãƒ‡ãƒã‚¤ã‚¹åˆ¶å¾¡è¨­å®š:" -ForegroundColor Yellow
    Write-Host "  - ç®¡ç†ã•ã‚ŒãŸãƒ‡ãƒã‚¤ã‚¹ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯" -ForegroundColor White
    Write-Host "  - æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã¨ã®é€£æº" -ForegroundColor White
    
    # 2. ID ãƒ™ãƒ¼ã‚¹ã®èªè¨¼å¼·åŒ–
    Write-Host "ğŸ” èªè¨¼å¼·åŒ–è¨­å®š:" -ForegroundColor Yellow
    Write-Host "  - å¤šè¦ç´ èªè¨¼ã®å¿…é ˆåŒ–" -ForegroundColor White
    Write-Host "  - ãƒªã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹" -ForegroundColor White
    
    # 3. ãƒ‡ãƒ¼ã‚¿åˆ†é¡ã¨ãƒ©ãƒ™ãƒªãƒ³ã‚°
    Write-Host "ğŸ·ï¸ ãƒ‡ãƒ¼ã‚¿ä¿è­·è¨­å®š:" -ForegroundColor Yellow
    Write-Host "  - Microsoft Purview æƒ…å ±ä¿è­·ã¨ã®çµ±åˆ" -ForegroundColor White
    Write-Host "  - è‡ªå‹•åˆ†é¡ã¨ãƒ©ãƒ™ãƒ«é©ç”¨" -ForegroundColor White
    
    # 4. ç¶™ç¶šçš„ãªç›£è¦–
    Write-Host "ğŸ‘ï¸ ç›£è¦–è¨­å®š:" -ForegroundColor Yellow
    Write-Host "  - Microsoft Defender for Cloud Appsã¨ã®é€£æº" -ForegroundColor White
    Write-Host "  - ç•°å¸¸ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º" -ForegroundColor White
    
    Write-Host "âœ… ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰å®Œäº†" -ForegroundColor Green
}

# å®Ÿè¡Œ
Implement-OneDriveZeroTrust
```

### 2025å¹´ã®æ–°æ©Ÿèƒ½å¯¾å¿œ

```powershell
# 2025å¹´æ–°æ©Ÿèƒ½ã®ç¢ºèªã¨æº–å‚™
function Check-OneDrive2025Features {
    Write-Host "ğŸš€ OneDrive 2025å¹´æ–°æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯..." -ForegroundColor Cyan
    
    $newFeatures = @(
        @{
            Name = "Enhanced AI Integration"
            Description = "Copilotçµ±åˆã®å¼·åŒ–ã¨AIè‡ªå‹•æ•´ç†"
            Status = "æº–å‚™ä¸­"
            Action = "ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚’ç¢ºèª"
        },
        @{
            Name = "Advanced Security Analytics"
            Description = "MLåŸºç›¤ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„…å¨æ¤œå‡º"
            Status = "ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆä¸­"
            Action = "Microsoft Defender for Cloud Appsè¨­å®šç¢ºèª"
        },
        @{
            Name = "Improved Collaboration"
            Description = "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±åŒç·¨é›†ã®å¼·åŒ–"
            Status = "åˆ©ç”¨å¯èƒ½"
            Action = "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨ˆç”»"
        },
        @{
            Name = "Sustainability Insights"
            Description = "ã‚«ãƒ¼ãƒœãƒ³ãƒ•ãƒƒãƒˆãƒ—ãƒªãƒ³ãƒˆå¯è¦–åŒ–"
            Status = "ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"
            Action = "ç’°å¢ƒå½±éŸ¿ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š"
        }
    )
    
    Write-Host "ğŸ“‹ 2025å¹´æ–°æ©Ÿèƒ½ä¸€è¦§:" -ForegroundColor Yellow
    foreach ($feature in $newFeatures) {
        Write-Host "  ğŸ”¹ $($feature.Name)" -ForegroundColor White
        Write-Host "    èª¬æ˜: $($feature.Description)" -ForegroundColor Gray
        Write-Host "    çŠ¶æ³: $($feature.Status)" -ForegroundColor $(if ($feature.Status -eq "åˆ©ç”¨å¯èƒ½") { "Green" } else { "Yellow" })
        Write-Host "    æ¨å¥¨å¯¾å¿œ: $($feature.Action)" -ForegroundColor Cyan
        Write-Host ""
    }
}

# å®Ÿè¡Œ
Check-OneDrive2025Features
```

---

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ğŸ“ æ•™è‚²æ©Ÿé–¢å‘ã‘ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†

##### å…ç«¥ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã®ä¿è­·

- å…ç«¥ç”Ÿå¾’ç”¨OneDriveã§ã¯å¤–éƒ¨å…±æœ‰ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–
- ç®¡ç†è€…ã«ã‚ˆã‚‹å®šæœŸçš„ãªã‚¢ã‚¯ã‚»ã‚¹ç›£æŸ»
- å€‹äººæƒ…å ±ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã®ç‰¹åˆ¥ãªä¿è­·è¨­å®š

```powershell
# æ•™è‚²æ©Ÿé–¢å‘ã‘ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
function Set-EducationalSecurityBaseline {
    Write-Host "ğŸ“ æ•™è‚²æ©Ÿé–¢å‘ã‘OneDriveã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šé©ç”¨ä¸­..." -ForegroundColor Cyan
    
    # å…ç«¥ç”Ÿå¾’å‘ã‘è¨­å®š
    Set-SPOTenant -OneDriveDefaultShareLinkScope "SpecificPeople"
    Set-SPOTenant -OneDriveDefaultShareLinkRole "View"
    Set-SPOTenant -RequireAcceptingAccountMatchInvitedAccount $true
    
    # å¤–éƒ¨å…±æœ‰ã®åˆ¶é™
    Set-SPOTenant -SharingCapability "ExternalUserSharingOnly"
    Set-SPOTenant -SharingDomainRestrictionMode "AllowList"
    
    Write-Host "âœ… æ•™è‚²æ©Ÿé–¢å‘ã‘ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šå®Œäº†" -ForegroundColor Green
}
```

#### 2. å®¹é‡ç®¡ç†æˆ¦ç•¥

##### å½¹å‰²åˆ¥å®¹é‡é…åˆ†

- æ•™è·å“¡: 5-15TBï¼ˆæ¥­å‹™å†…å®¹ã«å¿œã˜ã¦ï¼‰
- ç”Ÿå¾’: 1-5TBï¼ˆå­¦å¹´ãƒ»ã‚³ãƒ¼ã‚¹ã«å¿œã˜ã¦ï¼‰
- ç®¡ç†è€…: 15TBï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç”¨ï¼‰

##### å­¦æœŸãƒ»å¹´åº¦æœ«ã®æ•´ç†

```powershell
# å¹´åº¦æœ«ã®ãƒ‡ãƒ¼ã‚¿æ•´ç†è‡ªå‹•åŒ–
function Start-AcademicYearCleanup {
    param(
        [int]$GraduatingYear = (Get-Date).Year
    )
    
    Write-Host "ğŸ§¹ å¹´åº¦æœ«OneDriveãƒ‡ãƒ¼ã‚¿æ•´ç†é–‹å§‹..." -ForegroundColor Cyan
    
    # å’æ¥­ç”Ÿã®ç‰¹å®š
    $graduatingStudents = Get-MgUser -Filter "department eq 'Students' and employeeId like '$GraduatingYear*'"
    
    foreach ($student in $graduatingStudents) {
        Write-Host "ğŸ“‚ å‡¦ç†ä¸­: $($student.DisplayName)" -ForegroundColor Yellow
        
        # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‡¦ç†
        Archive-StudentOneDrive -StudentEmail $student.UserPrincipalName
    }
    
    Write-Host "âœ… å¹´åº¦æœ«æ•´ç†å®Œäº†" -ForegroundColor Green
}
```

### ä¸€èˆ¬çš„ãªãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

##### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

- æœ€å°æ¨©é™ã®åŸå‰‡ã‚’é©ç”¨
- å®šæœŸçš„ãªæ¨©é™ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå››åŠæœŸã”ã¨ï¼‰
- æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã¨ã®é€£æº
- å¤šè¦ç´ èªè¨¼ã®å¿…é ˆåŒ–

##### ãƒ‡ãƒ¼ã‚¿ä¿è­·

```powershell
# ãƒ‡ãƒ¼ã‚¿ä¿è­·ãƒãƒªã‚·ãƒ¼ã®å®Ÿè£…
function Implement-DataProtectionPolicies {
    Write-Host "ğŸ›¡ï¸ ãƒ‡ãƒ¼ã‚¿ä¿è­·ãƒãƒªã‚·ãƒ¼å®Ÿè£…ä¸­..." -ForegroundColor Cyan
    
    # æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•åˆ†é¡
    Set-SPOTenant -EnableSensitivityLabelForPDF $true
    
    # DLPï¼ˆãƒ‡ãƒ¼ã‚¿æå¤±é˜²æ­¢ï¼‰çµ±åˆ
    Write-Host "ğŸ’¡ ä»¥ä¸‹ã§DLPãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„:" -ForegroundColor Yellow
    Write-Host "  1. Microsoft Purview ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒãƒ¼ã‚¿ãƒ«" -ForegroundColor White
    Write-Host "  2. ãƒ‡ãƒ¼ã‚¿æå¤±é˜²æ­¢ > ãƒãƒªã‚·ãƒ¼" -ForegroundColor White
    Write-Host "  3. OneDrive for Businessã‚’å¯¾è±¡ã«è¿½åŠ " -ForegroundColor White
    
    Write-Host "âœ… ãƒ‡ãƒ¼ã‚¿ä¿è­·ãƒãƒªã‚·ãƒ¼è¨­å®šã‚¬ã‚¤ãƒ‰å®Œäº†" -ForegroundColor Green
}
```

#### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

##### åŒæœŸè¨­å®šã®æœ€é©åŒ–

- é©åˆ‡ãªãƒ•ã‚¡ã‚¤ãƒ«ç¨®é¡ã®é™¤å¤–
- å¸¯åŸŸå¹…åˆ¶é™ã®è¨­å®š
- å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†æˆ¦ç•¥

```powershell
# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–è¨­å®š
function Optimize-OneDrivePerformance {
    Write-Host "âš¡ OneDriveãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ä¸­..." -ForegroundColor Cyan
    
    # åŒæœŸé™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š
    $excludedExtensions = @("tmp", "temp", "cache", "log", "~")
    Set-SPOTenant -ExcludedFileExtensionsForSyncClient $excludedExtensions
    
    # å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã®è­¦å‘Šè¨­å®š
    Set-SPOTenant -OneDriveAccessRequests $false
    
    Write-Host "âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–å®Œäº†" -ForegroundColor Green
}
```

#### 3. ã‚¬ãƒãƒŠãƒ³ã‚¹ã¨é‹ç”¨

##### ç¶™ç¶šçš„ãªç›£è¦–

- ä½¿ç”¨çŠ¶æ³ã®å®šæœŸãƒ¬ãƒãƒ¼ãƒˆ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®è¿½è·¡
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®åé›†

##### å¤‰æ›´ç®¡ç†

- è¨­å®šå¤‰æ›´ã®æ–‡æ›¸åŒ–
- ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®äº‹å‰æ¤œè¨¼
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»ã®æº–å‚™

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. åŒæœŸã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: OneDriveã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒåŒæœŸã—ãªã„

**åŸå› ã¨å¯¾å‡¦æ³•**:
```powershell
# åŒæœŸå•é¡Œã®è¨ºæ–­
function Diagnose-OneDriveSyncIssues {
    param(
        [string]$UserEmail
    )
    
    Write-Host "ğŸ” OneDriveåŒæœŸå•é¡Œã®è¨ºæ–­é–‹å§‹..." -ForegroundColor Cyan
    
    # 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®OneDriveã‚µã‚¤ãƒˆç¢ºèª
    $oneDriveUrl = "https://yourtenant-my.sharepoint.com/personal/" + $UserEmail.Replace("@", "_").Replace(".", "_")
    
    try {
        $site = Get-SPOSite -Identity $oneDriveUrl
        Write-Host "âœ… OneDriveã‚µã‚¤ãƒˆ: æ­£å¸¸" -ForegroundColor Green
        Write-Host "   å®¹é‡ä½¿ç”¨: $($site.StorageUsageCurrent)MB / $($site.StorageQuota)MB" -ForegroundColor White
    }
    catch {
        Write-Host "âŒ OneDriveã‚µã‚¤ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼: $($_.Exception.Message)" -ForegroundColor Red
        return
    }
    
    # 2. åŒæœŸåˆ¶é™ã®ç¢ºèª
    $tenant = Get-SPOTenant
    Write-Host "ğŸ“‹ åŒæœŸè¨­å®šç¢ºèª:" -ForegroundColor Yellow
    Write-Host "   é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­: $($tenant.ExcludedFileExtensionsForSyncClient)" -ForegroundColor White
    Write-Host "   åŒæœŸå¯èƒ½ãƒ‰ãƒ¡ã‚¤ãƒ³: $($tenant.AllowedDomainGuids)" -ForegroundColor White
    
    # 3. è§£æ±ºæ–¹æ³•ã®æç¤º
    Write-Host "ğŸ”§ æ¨å¥¨è§£æ±ºæ‰‹é †:" -ForegroundColor Cyan
    Write-Host "   1. OneDriveã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å†èµ·å‹•" -ForegroundColor White
    Write-Host "   2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å†ãƒªãƒ³ã‚¯" -ForegroundColor White
    Write-Host "   3. é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªã¨ç§»å‹•" -ForegroundColor White
    Write-Host "   4. å®¹é‡ä¸è¶³ã®å ´åˆã¯ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†" -ForegroundColor White
}

# å®Ÿè¡Œä¾‹
# Diagnose-OneDriveSyncIssues -UserEmail "user@contoso.edu"
```

#### 2. å¤–éƒ¨å…±æœ‰ãŒã§ããªã„

**ç—‡çŠ¶**: ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤–éƒ¨å…±æœ‰ãƒªãƒ³ã‚¯ãŒç”Ÿæˆã§ããªã„

**å¯¾å‡¦æ³•**:
```powershell
# å¤–éƒ¨å…±æœ‰å•é¡Œã®è¨ºæ–­ã¨ä¿®æ­£
function Fix-OneDriveExternalSharingIssues {
    param(
        [string]$UserEmail,
        [string]$OneDriveUrl
    )
    
    Write-Host "ğŸ”— å¤–éƒ¨å…±æœ‰å•é¡Œã®è¨ºæ–­ä¸­..." -ForegroundColor Cyan
    
    # 1. ãƒ†ãƒŠãƒ³ãƒˆè¨­å®šç¢ºèª
    $tenant = Get-SPOTenant
    Write-Host "ğŸŒ ãƒ†ãƒŠãƒ³ãƒˆå…±æœ‰è¨­å®š:" -ForegroundColor Yellow
    Write-Host "   å…±æœ‰æ©Ÿèƒ½: $($tenant.SharingCapability)" -ForegroundColor White
    Write-Host "   å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æœŸé™: $($tenant.ExternalUserExpirationRequired)" -ForegroundColor White
    
    # 2. å€‹åˆ¥ã‚µã‚¤ãƒˆè¨­å®šç¢ºèª
    if ($OneDriveUrl) {
        $site = Get-SPOSite -Identity $OneDriveUrl
        Write-Host "ğŸ“‚ å€‹åˆ¥ã‚µã‚¤ãƒˆè¨­å®š:" -ForegroundColor Yellow
        Write-Host "   ã‚µã‚¤ãƒˆå…±æœ‰æ©Ÿèƒ½: $($site.SharingCapability)" -ForegroundColor White
    }
    
    # 3. ä¿®æ­£ææ¡ˆ
    Write-Host "ğŸ”§ ä¿®æ­£ææ¡ˆ:" -ForegroundColor Cyan
    
    if ($tenant.SharingCapability -eq "Disabled") {
        Write-Host "   âš ï¸ ãƒ†ãƒŠãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã§å¤–éƒ¨å…±æœ‰ãŒç„¡åŠ¹ã§ã™" -ForegroundColor Red
        Write-Host "   ğŸ’¡ å¯¾å‡¦: Set-SPOTenant -SharingCapability ExternalUserSharingOnly" -ForegroundColor Green
    }
    
    if ($site -and $site.SharingCapability -eq "Disabled") {
        Write-Host "   âš ï¸ ã‚µã‚¤ãƒˆãƒ¬ãƒ™ãƒ«ã§å¤–éƒ¨å…±æœ‰ãŒç„¡åŠ¹ã§ã™" -ForegroundColor Red
        Write-Host "   ğŸ’¡ å¯¾å‡¦: Set-SPOSite -Identity '$OneDriveUrl' -SharingCapability ExternalUserSharingOnly" -ForegroundColor Green
    }
}

# å®Ÿè¡Œä¾‹
# Fix-OneDriveExternalSharingIssues -UserEmail "user@contoso.edu" -OneDriveUrl "https://contoso-my.sharepoint.com/personal/user_contoso_edu"
```

#### 3. å®¹é‡ä¸è¶³ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®¹é‡ä¸è¶³ã‚¨ãƒ©ãƒ¼

**å¯¾å‡¦æ³•**:
```powershell
# å®¹é‡å•é¡Œã®è§£æ±º
function Resolve-OneDriveStorageIssues {
    param(
        [string]$UserEmail
    )
    
    Write-Host "ğŸ’¾ OneDriveå®¹é‡å•é¡Œã®è§£æ±ºä¸­..." -ForegroundColor Cyan
    
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®OneDriveæƒ…å ±å–å¾—
    $oneDriveUrl = "https://yourtenant-my.sharepoint.com/personal/" + $UserEmail.Replace("@", "_").Replace(".", "_")
    $site = Get-SPOSite -Identity $oneDriveUrl
    
    $usagePercent = [math]::Round(($site.StorageUsageCurrent / $site.StorageQuota) * 100, 2)
    
    Write-Host "ğŸ“Š ç¾åœ¨ã®å®¹é‡çŠ¶æ³:" -ForegroundColor Yellow
    Write-Host "   ä½¿ç”¨é‡: $($site.StorageUsageCurrent) MB" -ForegroundColor White
    Write-Host "   å‰²ã‚Šå½“ã¦: $($site.StorageQuota) MB" -ForegroundColor White
    Write-Host "   ä½¿ç”¨ç‡: $usagePercent%" -ForegroundColor $(if ($usagePercent -gt 90) { "Red" } else { "Green" })
    
    # è§£æ±ºç­–ã®ææ¡ˆ
    Write-Host "ğŸ”§ è§£æ±ºç­–:" -ForegroundColor Cyan
    
    if ($usagePercent -gt 95) {
        Write-Host "   ğŸš¨ ç·Šæ€¥: å®¹é‡å¢—åŠ ãŒå¿…è¦" -ForegroundColor Red
        Write-Host "   ğŸ’¡ å³æ™‚å¯¾å¿œ: Set-SPOSite -Identity '$oneDriveUrl' -StorageQuota $($site.StorageQuota + 5120)" -ForegroundColor Green
    }
    elseif ($usagePercent -gt 85) {
        Write-Host "   âš ï¸ æ³¨æ„: ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®æ•´ç†ã‚’æ¨å¥¨" -ForegroundColor Yellow
        Write-Host "   ğŸ’¡ å¯¾å¿œ: ã”ã¿ç®±ã®ç©ºã€å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–" -ForegroundColor Green
    }
    
    # è‡ªå‹•æ•´ç†ã®ææ¡ˆ
    Write-Host "ğŸ§¹ è‡ªå‹•æ•´ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³:" -ForegroundColor Cyan
    Write-Host "   1. ã”ã¿ç®±ã®è‡ªå‹•å‰Šé™¤è¨­å®š" -ForegroundColor White
    Write-Host "   2. å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ¶é™" -ForegroundColor White
    Write-Host "   3. å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã®SharePointãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã®ç§»å‹•" -ForegroundColor White
}

# å®Ÿè¡Œä¾‹
# Resolve-OneDriveStorageIssues -UserEmail "user@contoso.edu"
```

#### 4. ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®OneDriveã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

**å¯¾å‡¦æ³•**:
```powershell
# ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™å•é¡Œã®è¨ºæ–­ã¨ä¿®æ­£
function Fix-OneDriveAccessIssues {
    param(
        [string]$UserEmail
    )
    
    Write-Host "ğŸ” OneDriveã‚¢ã‚¯ã‚»ã‚¹æ¨©é™å•é¡Œã®è¨ºæ–­ä¸­..." -ForegroundColor Cyan
    
    # 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŸºæœ¬æƒ…å ±ç¢ºèª
    try {
        $user = Get-MgUser -UserId $UserEmail
        Write-Host "ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±:" -ForegroundColor Yellow
        Write-Host "   è¡¨ç¤ºå: $($user.DisplayName)" -ForegroundColor White
        Write-Host "   ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹: $(if ($user.AccountEnabled) { 'æœ‰åŠ¹' } else { 'ç„¡åŠ¹' })" -ForegroundColor $(if ($user.AccountEnabled) { "Green" } else { "Red" })
    }
    catch {
        Write-Host "âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $UserEmail" -ForegroundColor Red
        return
    }
    
    # 2. OneDriveãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç¢ºèª
    $licenses = $user.AssignedLicenses
    $hasOneDriveLicense = $false
    
    foreach ($license in $licenses) {
        $sku = Get-MgSubscribedSku -SubscribedSkuId $license.SkuId
        if ($sku.ServicePlans | Where-Object { $_.ServicePlanName -like "*ONEDRIVE*" -and $_.ProvisioningStatus -eq "Success" }) {
            $hasOneDriveLicense = $true
            break
        }
    }
    
    Write-Host "ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ³:" -ForegroundColor Yellow
    Write-Host "   OneDriveãƒ©ã‚¤ã‚»ãƒ³ã‚¹: $(if ($hasOneDriveLicense) { 'æœ‰åŠ¹' } else { 'ç„¡åŠ¹' })" -ForegroundColor $(if ($hasOneDriveLicense) { "Green" } else { "Red" })
    
    # 3. OneDriveã‚µã‚¤ãƒˆã®ç¢ºèª
    $oneDriveUrl = "https://yourtenant-my.sharepoint.com/personal/" + $UserEmail.Replace("@", "_").Replace(".", "_")
    
    try {
        $site = Get-SPOSite -Identity $oneDriveUrl
        Write-Host "ğŸŒ OneDriveã‚µã‚¤ãƒˆ: æ­£å¸¸" -ForegroundColor Green
    }
    catch {
        Write-Host "âŒ OneDriveã‚µã‚¤ãƒˆæœªä½œæˆã¾ãŸã¯å•é¡Œã‚ã‚Š" -ForegroundColor Red
        Write-Host "ğŸ’¡ å¯¾å‡¦: Request-SPOPersonalSite -UserEmails @('$UserEmail')" -ForegroundColor Green
    }
    
    # 4. è§£æ±ºæ‰‹é †ã®æç¤º
    Write-Host "ğŸ”§ æ¨å¥¨è§£æ±ºæ‰‹é †:" -ForegroundColor Cyan
    
    if (-not $user.AccountEnabled) {
        Write-Host "   1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æœ‰åŠ¹åŒ–" -ForegroundColor Red
    }
    
    if (-not $hasOneDriveLicense) {
        Write-Host "   2. OneDriveãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®å‰²ã‚Šå½“ã¦" -ForegroundColor Red
    }
    
    Write-Host "   3. OneDriveã‚µã‚¤ãƒˆã®åˆæœŸåŒ–å¾…æ©Ÿï¼ˆæœ€å¤§24æ™‚é–“ï¼‰" -ForegroundColor White
    Write-Host "   4. ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢" -ForegroundColor White
    Write-Host "   5. åˆ¥ã®ãƒ‡ãƒã‚¤ã‚¹ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ç¢ºèª" -ForegroundColor White
}

# å®Ÿè¡Œä¾‹
# Fix-OneDriveAccessIssues -UserEmail "user@contoso.edu"
```

### ç·Šæ€¥æ™‚å¯¾å¿œæ‰‹é †

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆæ™‚

```powershell
# ç·Šæ€¥æ™‚ã®OneDriveã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œ
function Invoke-OneDriveSecurityIncidentResponse {
    param(
        [string]$AffectedUserEmail,
        [string]$IncidentType = "DataBreach",
        [bool]$ImmediateAction = $true
    )
    
    Write-Host "ğŸš¨ OneDriveç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œé–‹å§‹" -ForegroundColor Red
    Write-Host "ğŸ“§ å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼: $AffectedUserEmail" -ForegroundColor Yellow
    Write-Host "ğŸ” ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç¨®é¡: $IncidentType" -ForegroundColor Yellow
    
    if ($ImmediateAction) {
        # 1. å³åº§ã«ã‚¢ã‚¯ã‚»ã‚¹åœæ­¢
        $oneDriveUrl = "https://yourtenant-my.sharepoint.com/personal/" + $AffectedUserEmail.Replace("@", "_").Replace(".", "_")
        Set-SPOSite -Identity $oneDriveUrl -LockState ReadOnly
        Write-Host "âœ… OneDriveã‚¢ã‚¯ã‚»ã‚¹ã‚’èª­ã¿å–ã‚Šå°‚ç”¨ã«åˆ¶é™" -ForegroundColor Green
        
        # 2. å¤–éƒ¨å…±æœ‰ã®å³åº§åœæ­¢
        Set-SPOSite -Identity $oneDriveUrl -SharingCapability Disabled
        Write-Host "âœ… å¤–éƒ¨å…±æœ‰ã‚’ç„¡åŠ¹åŒ–" -ForegroundColor Green
        
        # 3. ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç„¡åŠ¹åŒ–
        Revoke-MgUserSignInSession -UserId $AffectedUserEmail
        Write-Host "âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–" -ForegroundColor Green
    }
    
    # 4. ç›£æŸ»ãƒ­ã‚°ã®ç·Šæ€¥å–å¾—
    Write-Host "ğŸ“‹ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:" -ForegroundColor Cyan
    Write-Host "   1. ç›£æŸ»ãƒ­ã‚°ã®è©³ç´°åˆ†æ" -ForegroundColor White
    Write-Host "   2. å½±éŸ¿ç¯„å›²ã®ç‰¹å®š" -ForegroundColor White
    Write-Host "   3. é–¢ä¿‚è€…ã¸ã®é€šçŸ¥" -ForegroundColor White
    Write-Host "   4. å¾©æ—§è¨ˆç”»ã®ç­–å®š" -ForegroundColor White
}

# å®Ÿè¡Œä¾‹ï¼ˆç·Šæ€¥æ™‚ã®ã¿ï¼‰
# Invoke-OneDriveSecurityIncidentResponse -AffectedUserEmail "user@contoso.edu" -IncidentType "SuspiciousAccess"
```

### ãƒ˜ãƒ«ãƒ—ãƒ‡ã‚¹ã‚¯å‘ã‘ã‚¯ã‚¤ãƒƒã‚¯ã‚¬ã‚¤ãƒ‰

```text
=== OneDrive for Business ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ã‚¯ã‚¤ãƒƒã‚¯ã‚¬ã‚¤ãƒ‰ ===

ğŸ” ç—‡çŠ¶åˆ¥å¯¾å¿œãƒãƒ£ãƒ¼ãƒˆ:

â”œâ”€â”€ åŒæœŸã—ãªã„
â”‚   â”œâ”€â”€ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå†èµ·å‹• â†’ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†ãƒªãƒ³ã‚¯
â”‚   â”œâ”€â”€ å®¹é‡ç¢ºèª â†’ ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†
â”‚   â””â”€â”€ é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª â†’ ç§»å‹•ãƒ»å‰Šé™¤

â”œâ”€â”€ å…±æœ‰ã§ããªã„  
â”‚   â”œâ”€â”€ ãƒ†ãƒŠãƒ³ãƒˆè¨­å®šç¢ºèª â†’ ç®¡ç†è€…ã«é€£çµ¡
â”‚   â”œâ”€â”€ ã‚µã‚¤ãƒˆè¨­å®šç¢ºèª â†’ æ¨©é™ä»˜ä¸
â”‚   â””â”€â”€ ãƒ•ã‚¡ã‚¤ãƒ«ç¨®é¡ç¢ºèª â†’ è¨±å¯å½¢å¼ã«å¤‰æ›´

â”œâ”€â”€ å®¹é‡ä¸è¶³
â”‚   â”œâ”€â”€ ä½¿ç”¨é‡ç¢ºèª â†’ ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
â”‚   â”œâ”€â”€ ã”ã¿ç®±ç¢ºèª â†’ å®Œå…¨å‰Šé™¤
â”‚   â””â”€â”€ ç®¡ç†è€…ã«å®¹é‡å¢—åŠ ä¾é ¼

â””â”€â”€ ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„
    â”œâ”€â”€ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç¢ºèª â†’ ç®¡ç†è€…ã«é€£çµ¡
    â”œâ”€â”€ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹ç¢ºèª â†’ æœ‰åŠ¹åŒ–ä¾é ¼
    â””â”€â”€ ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢

ç·Šæ€¥é€£çµ¡å…ˆ: ITç®¡ç†è€… (å†…ç·š: XXXX)
```

---
